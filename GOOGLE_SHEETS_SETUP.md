# 🔗 사근복 AI - Google Sheets 연동 가이드 (신규 버전)

## 📋 목차
1. [Google Sheets 생성](#1-google-sheets-생성)
2. [시트 구조 설정](#2-시트-구조-설정)
3. [Apps Script 배포](#3-apps-script-배포)
4. [React 앱 연동](#4-react-앱-연동)
5. [테스트](#5-테스트)

---

## 1. Google Sheets 생성

### 1-1. 새 스프레드시트 만들기
1. Google Drive 접속: https://drive.google.com
2. `새로 만들기` → `Google Sheets` → `빈 스프레드시트`
3. 스프레드시트 이름: `사근복AI_회원관리_v2`

### 1-2. 스프레드시트 ID 확인
- URL에서 ID 복사: 
  ```
  https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit
  ```
- 예: `1ABC...XYZ` 부분

---

## 2. 시트 구조 설정

### 2-1. 기업회원 시트

**시트 이름**: `기업회원`

**열 구조** (A~I):
| 열 | 필드명 | 설명 | 예시 |
|----|--------|------|------|
| A | 회사명 | 회사 이름 | (주)사근복 |
| B | 기업회원분류 | 개인사업자/법인/병원 | 법인 |
| C | 추천인 | 사근복 컨설턴트 이름 | 홍길동 |
| D | 이름 | 대표자/담당자 이름 | 김철수 |
| E | 전화번호 | ID로 사용 | 010-1234-5678 |
| F | 이메일 | 이메일 주소 | company@example.com |
| G | 비밀번호 | 로그인 비밀번호 | pass1234 |
| H | 가입일 | 자동 입력 | 2026-01-21 |
| I | 승인상태 | 대기중/승인완료/거부 | 승인완료 |

**헤더 행 설정**:
```
A1: 회사명
B1: 기업회원분류
C1: 추천인
D1: 이름
E1: 전화번호
F1: 이메일
G1: 비밀번호
H1: 가입일
I1: 승인상태
```

### 2-2. 사근복컨설턴트 시트

**시트 이름**: `사근복컨설턴트`

**열 구조** (A~H):
| 열 | 필드명 | 설명 | 예시 |
|----|--------|------|------|
| A | 이름 | 컨설턴트 이름 | 홍길동 |
| B | 전화번호 | ID로 사용 | 010-8765-4321 |
| C | 이메일 | 이메일 주소 | consultant@sagunbok.com |
| D | 직함 | 직함/직책 | 수석 컨설턴트 |
| E | 소속사업단 | 선택 사항 | 서울사업단 |
| F | 소속지사 | 선택 사항 | 강남지사 |
| G | 가입일 | 자동 입력 | 2026-01-21 |
| H | 승인상태 | 대기중/승인완료/거부 | 승인완료 |

**헤더 행 설정**:
```
A1: 이름
B1: 전화번호
C1: 이메일
D1: 직함
E1: 소속사업단
F1: 소속지사
G1: 가입일
H1: 승인상태
```

### 2-3. 테스트 데이터 입력

#### 사근복컨설턴트 시트에 테스트 컨설턴트 추가:
```
A2: 홍길동
B2: 010-8765-4321
C2: hong@sagunbok.com
D2: 수석 컨설턴트
E2: 서울사업단
F2: 강남지사
G2: 2026-01-21
H2: 승인완료
```

---

## 3. Apps Script 배포

### 3-1. Apps Script 편집기 열기
1. Google Sheets에서 `확장 프로그램` → `Apps Script`
2. 새 프로젝트 생성

### 3-2. 코드 붙여넣기
1. `Code.gs` 파일에 제공된 스크립트 전체 복사
2. 스프레드시트 ID 설정:
   ```javascript
   const SPREADSHEET_ID = '여기에_스프레드시트_ID_입력';
   ```

### 3-3. 배포
1. 오른쪽 상단 `배포` → `새 배포`
2. 설정:
   - 유형: `웹 앱`
   - 실행 계정: `나`
   - 액세스 권한: `모든 사용자`
3. `배포` 클릭
4. **배포 URL 복사** (Apps Script 웹 앱 URL)
   ```
   https://script.google.com/macros/s/AKfycby.../exec
   ```

### 3-4. 권한 승인
- 첫 배포 시 Google 계정 권한 요청
- `고급` → `안전하지 않은 페이지로 이동` 클릭
- 권한 허용

---

## 4. React 앱 연동

### 4-1. Auth.tsx 수정
`/home/user/webapp/components/Auth.tsx` 파일에서 `BACKEND_URL` 업데이트:

```typescript
const BACKEND_URL = 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec';
```

### 4-2. 빌드 및 배포
```bash
cd /home/user/webapp
npm run build
./deploy-final-to-ec2.sh
```

---

## 5. 테스트

### 5-1. 컨설턴트 로그인 테스트
1. 사이트 접속
2. `사근복 컨설턴트` 탭 선택
3. 로그인:
   - ID: `010-8765-4321`
   - 비밀번호: `12345`
4. ✅ 로그인 성공 확인

### 5-2. 기업회원 가입 테스트
1. `회원가입` 클릭
2. `기업회원` 탭 선택
3. 입력:
   - 회사명: `테스트 주식회사`
   - 기업회원분류: `법인` 선택
   - 추천인: `홍길동` (등록된 컨설턴트 이름)
   - 이름: `김철수`
   - 전화번호: `010-1111-2222`
   - 이메일: `test@company.com`
   - 비밀번호: `test1234`
   - 비밀번호 확인: `test1234`
4. `회원가입` 클릭
5. ✅ "회원가입이 완료되었습니다" 메시지 확인

### 5-3. 승인 처리
1. Google Sheets → `기업회원` 시트
2. 방금 가입한 행 찾기
3. `I열` (승인상태) → `승인완료` 입력

### 5-4. 기업회원 로그인 테스트
1. `기업회원` 탭 선택
2. 로그인:
   - ID: `010-1111-2222`
   - 비밀번호: `test1234`
3. ✅ 로그인 성공 확인

### 5-5. 추천인 검증 테스트
1. 회원가입 시 존재하지 않는 추천인 입력
2. ❌ "등록되지 않은 추천인입니다" 오류 확인
3. 승인되지 않은 컨설턴트 이름 입력
4. ❌ 같은 오류 확인

---

## 🔐 보안 권장 사항

### 1. 비밀번호 암호화
현재는 평문 저장이지만, 프로덕션 환경에서는:
- Apps Script에서 해시 함수 사용
- 또는 외부 인증 서비스 연동 (Firebase Auth 등)

### 2. API 키 보호
- Apps Script 배포 URL은 공개되지 않도록 관리
- 필요 시 토큰 기반 인증 추가

### 3. 데이터 백업
- Google Sheets 자동 버전 관리 활용
- 정기적으로 시트 복사본 생성

---

## 📊 Google Sheets 구조 요약

```
📊 사근복AI_회원관리_v2
├── 기업회원 시트
│   ├── A: 회사명
│   ├── B: 기업회원분류 (개인사업자/법인/병원)
│   ├── C: 추천인 ⭐ (컨설턴트 이름 검증)
│   ├── D: 이름
│   ├── E: 전화번호 (ID)
│   ├── F: 이메일
│   ├── G: 비밀번호
│   ├── H: 가입일
│   └── I: 승인상태
│
└── 사근복컨설턴트 시트
    ├── A: 이름 ⭐ (추천인 검증용)
    ├── B: 전화번호 (ID)
    ├── C: 이메일
    ├── D: 직함
    ├── E: 소속사업단
    ├── F: 소속지사
    ├── G: 가입일
    └── H: 승인상태
```

---

## 🚨 문제 해결

### 문제: "등록되지 않은 추천인입니다" 오류
**해결**:
1. `사근복컨설턴트` 시트에 컨설턴트가 등록되어 있는지 확인
2. 컨설턴트의 `승인상태`가 `승인완료`인지 확인
3. 이름이 정확히 일치하는지 확인 (공백 주의)

### 문제: Apps Script 실행 오류
**해결**:
1. `SPREADSHEET_ID`가 올바르게 설정되었는지 확인
2. Apps Script 실행 로그 확인: `실행` → `실행 로그`
3. 권한이 제대로 승인되었는지 확인

### 문제: 로그인 안 됨
**해결**:
1. Google Sheets에서 `승인상태`가 `승인완료`인지 확인
2. 전화번호 형식 확인 (하이픈 포함 여부)
3. 비밀번호 일치 확인

---

## 📝 다음 단계

### 추가 기능 구현 가능
1. **이메일 알림**: 가입 시 관리자에게 이메일 발송
2. **비밀번호 재설정**: 이메일 인증을 통한 비밀번호 변경
3. **프로필 수정**: 로그인 후 정보 수정 기능
4. **관리자 대시보드**: 승인 관리 UI 개선

---

## 📞 지원

문제가 발생하면:
1. Google Sheets 데이터 확인
2. Apps Script 실행 로그 확인
3. 브라우저 콘솔 (F12) 에러 확인

🎉 **설정 완료!** 이제 추천인 검증이 포함된 회원가입 시스템이 작동합니다!
