# 관리자 대시보드 v5.0 배포 가이드

## 📋 개요

**버전**: 5.0  
**배포일**: 2026-01-23  
**주요 기능**: 전체 관리자 + 컨설턴트별 추천회원 관리 시스템

---

## 🎯 주요 기능

### 1. 전체 관리자 (이종근 계정)
- **전화번호**: 01063529091
- **권한**: 
  - ✅ 모든 회원 조회 (기업회원 + 사근복컨설턴트)
  - ✅ 회원 승인/거부 권한
  - ✅ 통계 대시보드 (전체/승인대기/승인완료/승인거부/기업회원/컨설턴트)
  - ✅ 검색 기능 (이름/전화번호/이메일/회사명/추천인)
  - ✅ 필터 기능 (전체/기업회원/컨설턴트)

### 2. 사근복 컨설턴트 대시보드
- **권한**:
  - ✅ 자신이 추천한 기업회원만 조회
  - ✅ 회원의 가입일, 승인 상태 확인
  - ❌ 승인/거부 권한 없음 (조회만 가능)
  - ❌ 다른 컨설턴트 정보 조회 불가

---

## 🚀 Apps Script 배포 방법

### Step 1: Apps Script 에디터 접속
1. Google Sheets 열기: https://docs.google.com/spreadsheets/d/1NzBVwAjDTSQWznBapoD1fGspUvXpvQsozdJVSEF5Atc/edit
2. **확장 프로그램 > Apps Script** 클릭

### Step 2: 코드 업데이트
1. 기존 코드 전체 삭제
2. `google-apps-script-v5-admin.js` 파일 내용 복사
3. Apps Script 에디터에 붙여넣기
4. **저장** (Ctrl+S 또는 💾 아이콘)

### Step 3: 새 배포
1. **배포 > 새 배포** 클릭
2. **배포 유형 선택**:
   - ⚙️ 아이콘 클릭 → **웹 앱** 선택
3. **설정**:
   - 설명: `v5.0 - 관리자 대시보드`
   - 실행 계정: **나**
   - 액세스 권한: **모든 사용자**
4. **배포** 클릭
5. **액세스 승인** 클릭
6. Google 계정 선택 후 **고급 > (안전하지 않은 페이지로 이동)** 클릭
7. **허용** 클릭
8. **웹 앱 URL** 복사 (예: `https://script.google.com/macros/s/.../exec`)

### Step 4: 기존 배포 업데이트 (선택사항)
기존 배포를 유지하면서 업데이트:
1. **배포 > 배포 관리** 클릭
2. 기존 배포 옆 **연필 아이콘(편집)** 클릭
3. **버전 > 새 버전** 선택
4. **배포** 클릭

---

## 📊 Google Sheets 구조

### 기업회원 시트 (9개 컬럼)
| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| 회사명 | 기업회원분류 | 추천인 | 이름 | 전화번호 | 이메일 | 비밀번호 | 가입일(KST) | 승인여부 |

### 사근복컨설턴트 시트 (9개 컬럼)
| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| 이름 | 전화번호 | 이메일 | 직함 | 소속사업단 | 소속지사 | 비밀번호 | 가입일(KST) | 승인여부 |

### 로그기록 시트 (8개 컬럼)
| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 타임스탬프(KST) | 액션유형 | 사용자유형 | 사용자ID | 상세내용 | IP주소 | 상태 | 에러메시지 |

---

## 🔌 API 엔드포인트

### 1. getAllMembers (전체 회원 조회)
**요청**:
```json
{
  "action": "getAllMembers"
}
```

**응답**:
```json
{
  "success": true,
  "members": [
    {
      "type": "company",
      "companyName": "테스트병원",
      "companyType": "법인",
      "referrer": "이종근",
      "name": "홍길동",
      "phone": "01012345678",
      "email": "test@test.com",
      "registeredAt": "2026-01-23 17:00:00",
      "status": "승인대기"
    },
    {
      "type": "consultant",
      "name": "김컨설턴트",
      "phone": "01087654321",
      "email": "consultant@test.com",
      "position": "수석컨설턴트",
      "division": "서울사업단",
      "branch": "강남지사",
      "registeredAt": "2026-01-23 16:00:00",
      "status": "승인완료"
    }
  ]
}
```

### 2. updateMemberStatus (승인 상태 업데이트)
**요청**:
```json
{
  "action": "updateMemberStatus",
  "phone": "01012345678",
  "type": "company",
  "status": "승인완료"
}
```

**응답**:
```json
{
  "success": true,
  "message": "승인 상태가 업데이트되었습니다."
}
```

---

## 🎨 관리자 대시보드 UI

### 전체 관리자 화면
```
┌─────────────────────────────────────────┐
│  전체 관리자 대시보드                     │
│  모든 회원을 관리하고 승인할 수 있습니다. │
└─────────────────────────────────────────┘

통계 카드:
[전체: 125] [승인대기: 15] [승인완료: 100] 
[승인거부: 10] [기업회원: 90] [컨설턴트: 35]

필터 버튼:
[전체] [🏢 기업회원] [👔 컨설턴트]

검색창:
[이름, 전화번호, 이메일, 회사명 검색...]

회원 테이블:
┌──────┬──────┬────────┬─────────┬──────┬──────┬────────┬──────┬──────┐
│ 구분 │ 이름 │ 전화번호 │ 이메일   │ 회사명│ 추천인│ 가입일  │ 상태 │ 액션 │
├──────┼──────┼────────┼─────────┼──────┼──────┼────────┼──────┼──────┤
│ 🏢기업│홍길동│010-1234 │test@...  │테스트│이종근│2026-01 │승인대기│[승인]│
│ 👔컨설│김철수│010-5678 │kim@...   │  -   │  -   │2026-01 │승인완료│[거부]│
└──────┴──────┴────────┴─────────┴──────┴──────┴────────┴──────┴──────┘
```

### 컨설턴트 대시보드 화면
```
┌─────────────────────────────────────────┐
│  컨설턴트 대시보드                        │
│  이종근님이 추천한 기업회원 리스트입니다. │
└─────────────────────────────────────────┘

통계 카드:
[전체: 25] [승인대기: 5] [승인완료: 18] [승인거부: 2]

회원 테이블:
┌──────┬──────┬────────┬─────────┬──────┬──────┬────────┬──────┐
│ 구분 │ 이름 │ 전화번호 │ 이메일   │ 회사명│ 추천인│ 가입일  │ 상태 │
├──────┼──────┼────────┼─────────┼──────┼──────┼────────┼──────┤
│ 🏢기업│홍길동│010-1234 │test@...  │테스트│이종근│2026-01 │승인대기│
│ 🏢기업│박영희│010-5678 │park@...  │ABC병원│이종근│2026-01 │승인완료│
└──────┴──────┴────────┴─────────┴──────┴──────┴────────┴──────┘

💡 안내:
• 내가 추천한 기업회원만 표시됩니다.
• 승인 권한은 전체 관리자만 가능합니다.
```

---

## 🔐 권한 관리

### 전체 관리자 확인 로직
```typescript
const isSuperAdmin = currentUser?.phone === '01063529091';
```

### 컨설턴트 권한 확인
```typescript
const isConsultant = currentUser?.userType === 'consultant';
const consultantName = currentUser?.name;

// 필터링: 자신이 추천한 회원만 조회
if (isConsultant && !isSuperAdmin) {
  if (m.type === 'company' && m.referrer !== consultantName) {
    return false; // 숨김
  }
  if (m.type === 'consultant') {
    return false; // 다른 컨설턴트 숨김
  }
}
```

---

## 📝 테스트 시나리오

### 시나리오 1: 전체 관리자 (이종근)
1. **로그인**: 
   - 전화번호: `01063529091`
   - 비밀번호: (설정된 비밀번호)
2. **대시보드 접속**: 왼쪽 사이드바 > **ADMIN DASHBOARD** 클릭
3. **확인 사항**:
   - ✅ "전체 관리자 대시보드" 헤더 표시
   - ✅ 통계 카드 6개 표시 (전체/대기/완료/거부/기업/컨설턴트)
   - ✅ 필터 버튼 3개 (전체/기업회원/컨설턴트)
   - ✅ 모든 회원 리스트 표시
   - ✅ 각 회원에 [승인]/[거부] 버튼 표시
4. **승인 테스트**:
   - 승인대기 회원 선택
   - [승인] 버튼 클릭
   - 상태가 "승인완료"로 변경되는지 확인
   - Google Sheets에서 직접 확인

### 시나리오 2: 사근복 컨설턴트
1. **로그인**: 
   - 전화번호: (컨설턴트 전화번호)
   - 비밀번호: `12345`
2. **대시보드 접속**: 왼쪽 사이드바 > **ADMIN DASHBOARD** 클릭
3. **확인 사항**:
   - ✅ "컨설턴트 대시보드" 헤더 표시
   - ✅ 통계 카드 4개만 표시 (전체/대기/완료/거부)
   - ✅ 필터 버튼 2개 (전체/기업회원)
   - ✅ 자신이 추천한 기업회원만 표시
   - ✅ [승인]/[거부] 버튼 없음
   - ✅ 안내 메시지 박스 표시

---

## 🔧 배포 정보

### EC2 배포
- **배포 시간**: 2026-01-23 08:53 UTC
- **배포 파일**: `dist-admin-dashboard-20260123085318.tar.gz`
- **백업 경로**: `/var/www/sagunbok.backup.YYYYMMDDHHMMSS`
- **접속 URL**: http://3.34.186.174/

### Git 정보
- **Commit**: `c9e7355`
- **Message**: "feat: 관리자 대시보드 v5.0 - 전체관리자(이종근) + 컨설턴트별 추천회원 관리"
- **Repository**: https://github.com/masolshop/sagunbok.git
- **Branch**: main

---

## ⚠️ 중요 사항

### 1. Apps Script 배포 필수
- **반드시** Apps Script를 업데이트하고 새로 배포해야 합니다.
- 기존 v4.0 스크립트로는 관리자 API가 작동하지 않습니다.

### 2. 전체 관리자 계정
- 전화번호 `01063529091`은 하드코딩되어 있습니다.
- 다른 관리자를 추가하려면 코드 수정 필요:
  ```typescript
  const isSuperAdmin = ['01063529091', '01012345678'].includes(currentUser?.phone);
  ```

### 3. 추천인 필드 정확성
- 컨설턴트 대시보드는 **추천인(C열)** 필드를 기준으로 필터링합니다.
- 추천인 이름이 정확히 일치해야 합니다 (대소문자 구분).

### 4. 승인 상태 값
- 반드시 다음 값 중 하나여야 합니다:
  - `승인대기`
  - `승인완료`
  - `승인거부`

---

## 📞 문의 및 지원

문제 발생 시 확인 사항:
1. Apps Script가 v5.0로 업데이트되었는지 확인
2. Google Sheets의 컬럼 구조가 정확한지 확인
3. 브라우저 콘솔(F12)에서 에러 메시지 확인
4. 로그기록 시트에서 API 호출 로그 확인

---

## 🎉 완료!

모든 배포가 완료되었습니다. 지금 바로 테스트하세요!

**접속 URL**: http://3.34.186.174/

**전체 관리자 로그인**:
- 전화번호: `01063529091`
- 비밀번호: (설정된 비밀번호)
