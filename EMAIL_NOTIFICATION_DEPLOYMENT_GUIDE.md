# 📧 사근복 AI v6.2 - 이메일 알림 시스템 배포 가이드

## 🎯 새로운 기능 (v6.2)

### ✅ 자동 이메일 알림

#### 1️⃣ **컨설턴트 회원가입 시**
- ✉️ **관리자**: 승인 대기 알림
- ✉️ **컨설턴트 본인**: 가입 완료 알림 (초기 비밀번호 포함)

#### 2️⃣ **컨설턴트 승인 시**
- ✉️ **컨설턴트 본인**: 승인 완료 알림

#### 3️⃣ **기업회원 가입 시**
- ✉️ **관리자**: 승인 대기 알림
- ✉️ **기업회원 본인**: 가입 완료 알림
- ✉️ **추천인 컨설턴트**: 추천 회원 가입 알림

#### 4️⃣ **기업회원 승인 시**
- ✉️ **기업회원 본인**: 승인 완료 알림

---

## 📝 배포 전 준비사항

### ⚠️ **관리자 이메일 설정 필수!**

Apps Script 코드에서 다음 부분을 **실제 관리자 이메일**로 변경해주세요:

```javascript
// 관리자 이메일 - TODO: 실제 관리자 이메일로 변경
const ADMIN_EMAIL = 'admin@sagunbok.com';  // ← 이 부분을 변경하세요!
```

**예시:**
```javascript
const ADMIN_EMAIL = 'ceo@femayeon.com';  // 실제 관리자 이메일
```

---

## 🚀 배포 단계

### 1️⃣ **Apps Script 에디터 열기**

1. Google Sheets 열기:
   ```
   https://docs.google.com/spreadsheets/d/1NzBVwAjDTSQWznBapoD1fGspUvXpvQsozdJVSEF5Atc/edit
   ```

2. **확장 프로그램** → **Apps Script** 클릭

---

### 2️⃣ **코드 업데이트**

1. 기존 코드를 **모두 삭제**

2. 새 v6.2 코드를 **전체 복사 & 붙여넣기**
   - 파일: `google-apps-script-v6.2-complete.js`
   - **중요**: ADMIN_EMAIL을 실제 이메일로 변경!

3. **저장** (Ctrl+S 또는 💾 아이콘)

---

### 3️⃣ **새 배포 만들기**

1. **배포** → **배포 관리**

2. 기존 배포를 **보관처리** (선택사항)

3. **배포** → **새 배포**

4. **설정** (매우 중요!):
   - 설명: `v6.2 이메일 알림 시스템`
   - 유형: **웹 앱** ⚠️
   - 실행 계정: **나** ⚠️
   - 액세스 권한: **누구나** ⚠️

5. **배포** 클릭

---

### 4️⃣ **이메일 발송 권한 승인**

처음 배포 시 **추가 권한 승인**이 필요합니다:

1. **권한 검토** 클릭

2. Google 계정 선택

3. **고급** 클릭

4. **"[프로젝트명]으로 이동(안전하지 않음)"** 클릭

5. **Gmail 이메일 발송 권한 허용**
   - ✅ Gmail로 이메일 보내기
   - ✅ 스프레드시트 읽기/쓰기
   - ✅ Google Drive 파일 관리

6. **허용** 클릭

---

### 5️⃣ **새 URL 확인 및 복사**

배포 완료 후 나타나는 **웹 앱 URL** 복사:

```
https://script.google.com/macros/s/[NEW_DEPLOYMENT_ID]/exec
```

---

## 📧 이메일 템플릿 미리보기

### **컨설턴트 회원가입 - 본인용**

```
제목: [사근복 AI] 회원가입 신청이 완료되었습니다

🎉 회원가입 신청 완료
사근복 AI에 오신 것을 환영합니다

이름: 홍길동
전화번호: 010-1234-5678
이메일: hong@example.com
직함: 대리
소속사업단: 수도권
소속지사: 서울지사
초기 비밀번호: 12345
상태: 승인대기

📌 다음 단계
1. 관리자 승인 대기
2. 승인 완료 알림 수신
3. 로그인 (초기 비밀번호: 12345)
4. 비밀번호 변경

⚠️ 보안 안내: 로그인 후 즉시 비밀번호를 변경해주세요.
```

---

### **기업회원 가입 - 추천인용**

```
제목: [사근복 AI] 추천한 기업회원이 가입했습니다

🎯 추천한 기업회원 가입
회원님이 추천한 기업회원이 가입했습니다

회사명: (주)테스트컴퍼니
회원분류: 법인사업자
담당자: 김철수
전화번호: 010-9876-5432
이메일: kim@test.com
가입일: 2026-01-23 20:00:00
상태: 승인대기

💡 알림: 관리자가 승인하면 추천 목록에 추가됩니다.
```

---

## 🧪 테스트 방법

### 1️⃣ **컨설턴트 회원가입 테스트**

1. 프론트엔드에서 컨설턴트 회원가입 진행
2. 다음 이메일 확인:
   - ✉️ 관리자 이메일 (승인 요청)
   - ✉️ 본인 이메일 (가입 완료)

### 2️⃣ **기업회원 가입 테스트**

1. 프론트엔드에서 기업회원 가입 진행
2. 추천인 이름 입력
3. 다음 이메일 확인:
   - ✉️ 관리자 이메일 (승인 요청)
   - ✉️ 본인 이메일 (가입 완료)
   - ✉️ 추천인 이메일 (추천 회원 알림)

### 3️⃣ **승인 테스트**

1. 관리자 대시보드에서 회원 승인
2. 본인 이메일 확인:
   - ✉️ 승인 완료 알림

---

## ⚠️ 주의사항

### 1️⃣ **Gmail 일일 발송 제한**

Google Apps Script에서 Gmail API 사용 시 일일 발송 제한이 있습니다:

- **개인 계정**: 하루 100통
- **Google Workspace**: 하루 1,500통

### 2️⃣ **스팸 메일함 확인**

처음 발송되는 이메일은 **스팸 메일함**에 들어갈 수 있습니다.

**해결 방법**:
- 스팸 메일함 확인
- "스팸 아님" 처리
- 발신자를 연락처에 추가

### 3️⃣ **이메일 주소 확인**

회원가입 시 입력한 이메일 주소가 정확한지 확인하세요.

---

## 🔧 문제 해결

### **이메일이 발송되지 않는 경우**

#### 1️⃣ **권한 확인**

Apps Script 에디터에서:
1. **프로젝트 설정** (⚙️) 클릭
2. **권한** 탭 확인
3. Gmail 발송 권한이 있는지 확인

#### 2️⃣ **로그 확인**

Google Sheets → 로그기록 시트에서 이메일 발송 로그 확인:

- `이메일발송` 액션 검색
- 상태: `성공` / `실패` 확인
- 에러 메시지 확인

#### 3️⃣ **Apps Script 실행 로그**

Apps Script 에디터에서:
1. **실행** (▶️) 버튼 옆의 드롭다운
2. 함수 선택: `sendEmail`
3. **실행** 클릭
4. **실행 로그** 확인

---

## 📊 이메일 발송 흐름

```
회원가입
    ↓
registerConsultant() / registerCompany()
    ↓
sendConsultantSignupEmails() / sendCompanySignupEmails()
    ↓
sendEmail() 함수 호출
    ↓
MailApp.sendEmail()
    ↓
Gmail로 이메일 발송
    ↓
로그기록 시트에 기록
```

---

## 🎯 체크리스트

- [ ] ADMIN_EMAIL을 실제 관리자 이메일로 변경
- [ ] Apps Script 코드 업데이트
- [ ] 새 배포 생성 (v6.2)
- [ ] 이메일 발송 권한 승인
- [ ] 새 URL 복사
- [ ] 컨설턴트 회원가입 테스트
- [ ] 기업회원 가입 테스트
- [ ] 승인 테스트
- [ ] 이메일 수신 확인
- [ ] 로그 확인

---

## 📞 다음 단계

1. **ADMIN_EMAIL 설정** ← **필수!**
2. **새 배포 URL 공유**
3. **프론트엔드 업데이트** (필요 시)
4. **테스트 진행**

---

**배포 준비 완료!** 🚀

ADMIN_EMAIL을 설정하고 새 배포 URL을 알려주시면 바로 테스트하겠습니다!

---

**작성일**: 2026-01-23 20:00 KST
