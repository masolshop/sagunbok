# 📋 Apps Script V5.4 FINAL - H/I 열 순서 변경

**작성일**: 2026-01-21 18:05  
**버전**: V5.4 FINAL  
**커밋**: bad9930  
**변경사항**: H열=추천인, I열=승인상태로 순서 변경

---

## 🎯 V5.4 핵심 변경사항

### ✅ 구글 시트 기준에 맞춰 열 순서 수정

**이전 (V5.3)**:
- H열: 승인상태
- I열: 추천인

**현재 (V5.4)**:
- **H열: 추천인** ← 변경!
- **I열: 승인상태** ← 변경!

---

## 📊 최종 시트 구조

### [기업회원] 시트

| 열 | 필드명 | 형식 | 예시 |
|---|--------|------|------|
| A | 가입일시 | 일반 | 2026-01-21 17:35:20 |
| B | 회사명 | 텍스트 | AI테스트병원 |
| C | 기업유형 | 텍스트 | 병의원개인사업자 |
| D | 이름 | 텍스트 | AI테스터 |
| **E** | **핸드폰번호** | **⚠️ 일반 텍스트** | **'010-9988-7766** |
| F | 이메일 | 텍스트 | ai-test@hospital.com |
| G | 비밀번호 | 텍스트 | test1234 |
| **H** | **추천인** | **텍스트** | **김철수** ← 변경됨! |
| **I** | **승인상태** | **텍스트** | **승인전표** ← 변경됨! |
| J | (비어있음) | - | - |
| K | 마지막로그인 | 일반 | 2026-01-21 18:00:00 |

---

## 🔧 코드 변경 내역

### 1. registerCompany() - 데이터 저장 순서

**이전 (V5.3)**:
```javascript
const rowData = [
  timestamp,            // A: 가입일시
  companyName,          // B: 회사명
  companyType,          // C: 기업유형
  name,                 // D: 이름
  formattedPhone,       // E: 핸드폰번호
  email,                // F: 이메일
  password,             // G: 비밀번호
  '승인전표',           // H: 승인상태
  referrer              // I: 추천인
];
```

**현재 (V5.4)**:
```javascript
const rowData = [
  timestamp,            // A: 가입일시
  companyName,          // B: 회사명
  companyType,          // C: 기업유형
  name,                 // D: 이름
  formattedPhone,       // E: 핸드폰번호
  email,                // F: 이메일
  password,             // G: 비밀번호
  referrer,             // H: 추천인 ← 변경!
  '승인전표'            // I: 승인상태 ← 변경!
];
```

---

### 2. loginCompany() - 데이터 읽기 인덱스

**이전 (V5.3)**:
```javascript
const approvalStatus = String(row[7]);      // H열: 승인상태
// ...
userData: {
  // ...
  approvalStatus: row[7], // H열: 승인상태
  referrer: row[8],       // I열: 추천인
}
```

**현재 (V5.4)**:
```javascript
const approvalStatus = String(row[8]);      // I열: 승인상태 ← 변경!
// ...
userData: {
  // ...
  referrer: row[7],       // H열: 추천인 ← 변경!
  approvalStatus: row[8], // I열: 승인상태 ← 변경!
}
```

---

### 3. doGet() - 시트 구조 응답

**이전 (V5.3)**:
```javascript
sheetStructure: {
  // ...
  H: '승인상태',
  I: '추천인',
  // ...
}
```

**현재 (V5.4)**:
```javascript
sheetStructure: {
  // ...
  H: '추천인',  // 변경!
  I: '승인상태', // 변경!
  // ...
}
```

---

### 4. validateSheetStructure() - 예상 헤더

**이전 (V5.3)**:
```javascript
const expectedHeaders = [
  '가입일시', '회사명', '기업유형', '이름', '핸드폰번호',
  '이메일', '비밀번호', '승인상태', '추천인', '', '마지막로그인'
];
```

**현재 (V5.4)**:
```javascript
const expectedHeaders = [
  '가입일시', '회사명', '기업유형', '이름', '핸드폰번호',
  '이메일', '비밀번호', '추천인', '승인상태', '', '마지막로그인'
];
//                       ↑ H열     ↑ I열  (순서 변경!)
```

---

## 📋 배포 가이드

### 1️⃣ 코드 복사 및 배포

```
1. Google Apps Script 편집기 열기
2. 기존 코드 전체 삭제 (Ctrl+A → Delete)
3. V5.4 코드 복사 (/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.4_FINAL.js)
4. 붙여넣기 (Ctrl+V)
5. 저장 (Ctrl+S)
6. 배포 → 새 배포 → 웹 앱
```

---

### 2️⃣ Google Sheets 헤더 확인

**[기업회원] 시트 1행 헤더**:

| A | B | C | D | E | F | G | H | I | J | K |
|---|---|---|---|---|---|---|---|---|---|---|
| 가입일시 | 회사명 | 기업유형 | 이름 | 핸드폰번호 | 이메일 | 비밀번호 | **추천인** | **승인상태** | (비어있음) | 마지막로그인 |

**⚠️ H열=추천인, I열=승인상태 확인!**

---

### 3️⃣ E열 텍스트 형식 설정

```
1. E열 전체 선택 (E 헤더 클릭)
2. 서식 → 숫자 → 일반 텍스트
3. ✅ "일반 텍스트" 표시 확인
```

---

### 4️⃣ 사근복컨설턴트 시트 확인

```
1. A열에 "대기중" 있으면 삭제
2. 테스트 데이터 추가 (김철수, 이영희 등)
```

---

### 5️⃣ 검증 실행

```
1. Apps Script 편집기에서 함수 선택: validateSheetStructure
2. 실행 (▶️)
3. 로그 확인:
   - 현재 헤더: ... | 추천인 | 승인상태 | ...
   - 예상 헤더: ... | 추천인 | 승인상태 | ...
   - ✅ 기업회원 시트 구조 정상
```

---

## 🧪 테스트 시나리오

### 테스트 1: 정상 회원가입

**입력 데이터**:
```
회사명: AI테스트병원
기업유형: 병의원개인사업자
담당자: AI테스터
휴대폰: 01099887766
이메일: ai-test@hospital.com
비밀번호: test1234
추천인: 김철수
```

**예상 결과**:
```
✅ "회원가입 신청이 완료되었습니다."
```

**Google Sheets 확인** (기업회원 시트 2행):

| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| 2026-01-21 18:10:00 | AI테스트병원 | 병의원개인사업자 | AI테스터 | '010-9988-7766 | ai-test@hospital.com | test1234 | **김철수** | **승인전표** |

**✅ 확인사항**:
- H열: `김철수` ← 추천인!
- I열: `승인전표` ← 승인상태!

---

### 테스트 2: 추천인 검증 실패

**입력**: 추천인 = `박영수` (존재하지 않는 이름)

**예상 결과**:
```
❌ "추천인 정보가 올바르지 않습니다.
등록된 컨설턴트: 김철수, 이영희"
```

---

## 📁 생성된 파일

| 파일명 | 경로 | 크기 | 설명 |
|-------|------|-----|------|
| **APPS_SCRIPT_V5.4_FINAL.js** | `/home/user/webapp/docs/apps-script-v5/` | 22.7KB (795줄) | V5.4 최종 코드 |

---

## 🔗 링크

| 항목 | 정보 |
|-----|------|
| **버전** | V5.4 FINAL |
| **커밋** | bad9930 |
| **배포 URL** | (재배포 후 새 URL 사용) |
| **프런트엔드** | http://3.34.186.174 |

---

## 🎯 체크리스트

### Google Sheets 준비

- [ ] **헤더 확인: H=추천인, I=승인상태**
- [ ] **E열 "일반 텍스트"로 설정**
- [ ] **사근복컨설턴트 시트에서 "대기중" 삭제**
- [ ] **기업회원 시트 2행 이하 데이터 삭제**

### Apps Script 배포

- [ ] **V5.4 코드 붙여넣기**
- [ ] **validateSheetStructure() 실행 → 헤더 확인**
- [ ] **runAllTests() 실행 → 3개 통과 확인**
- [ ] **웹 앱으로 배포 → 새 URL 복사**

### 브라우저 테스트

- [ ] **정상 회원가입 (추천인: 김철수) → ✅ 성공**
- [ ] **Google Sheets H열: 김철수 확인**
- [ ] **Google Sheets I열: 승인전표 확인**
- [ ] **추천인 검증 실패 → ❌ 차단**

---

## 📊 V5.3 vs V5.4 비교

| 항목 | V5.3 | V5.4 |
|-----|------|------|
| H열 | 승인상태 | **추천인** ← 변경! |
| I열 | 추천인 | **승인상태** ← 변경! |
| registerCompany rowData | [..., '승인전표', referrer] | [..., referrer, '승인전표'] |
| loginCompany 인덱스 | row[7]=승인, row[8]=추천인 | row[7]=추천인, row[8]=승인 |

---

## 🎉 결론

✅ **V5.4 변경사항**:
- H열 = 추천인
- I열 = 승인상태

✅ **배포 준비 완료**:
- 코드: `/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.4_FINAL.js`
- 커밋: bad9930
- 상태: 배포 대기

✅ **다음 단계**:
1. Google Sheets 헤더 확인 (H=추천인, I=승인상태)
2. V5.4 코드 배포
3. 브라우저 테스트
4. 데이터 확인

---

**작성일**: 2026-01-21 18:05  
**버전**: V5.4 FINAL  
**파일**: /home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.4_FINAL.js
