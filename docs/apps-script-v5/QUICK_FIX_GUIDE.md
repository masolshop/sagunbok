# 🚨 Apps Script V5.3 긴급 수정 가이드

**작성일**: 2026-01-21 17:35  
**상태**: ⚠️ 긴급  
**소요 시간**: 5분

---

## ❌ 현재 문제점

1. **시트 열 순서 불일치** - 데이터가 잘못된 위치에 저장됨
2. **전화번호 앞자리 0 손실** - `1099887766` (010이 사라짐)
3. **추천인 검증 미작동** - "대기중"이 입력되었는데 가입 허용됨

---

## ✅ 코드 상태

**V5.3 코드는 100% 정확합니다!**

문제는 **Google Sheets 설정**입니다.

---

## 🎯 5분 긴급 수정

### 1단계: E열 텍스트로 변경 (1분)

```
1. Google Sheets → [기업회원] 시트 열기
2. E열 전체 선택 (E 헤더 클릭)
3. 상단 메뉴: 서식 → 숫자 → 일반 텍스트
4. ✅ "일반 텍스트" 표시 확인
```

**왜 필요한가?**
- Google Sheets는 `01099887766`을 숫자로 인식 → `1099887766`으로 변환
- "일반 텍스트"로 설정하면 `'010-9988-7766` 형식으로 저장되어 0 유지

---

### 2단계: "대기중" 삭제 (1분)

```
1. [사근복컨설턴트] 시트 열기
2. A열에서 "대기중" 찾기
3. 해당 행 전체 선택 → 마우스 우클릭 → 행 삭제
4. ✅ "대기중"이 완전히 사라졌는지 확인
```

**왜 삭제해야 하나?**
- V5.3은 사근복컨설턴트 시트의 A열(이름)과 추천인을 정확히 매칭
- "대기중"이 있으면 추천인으로 "대기중" 입력 시 가입 허용됨!

---

### 3단계: 기존 데이터 삭제 (1분)

```
1. [기업회원] 시트에서 2행 이하 모든 데이터 삭제
2. 헤더(1행)만 남기기
```

**왜 필요한가?**
- 기존 데이터는 E열이 숫자 형식으로 저장되어 0이 사라진 상태
- 삭제 후 재가입해야 올바른 형식으로 저장됨

---

### 4단계: 검증 (1분)

```
1. Apps Script 편집기 열기
2. 함수 선택: validateSheetStructure
3. 실행 (▶️)
4. 로그 확인 (Ctrl+Enter)
```

**예상 로그**:
```
등록된 사근복컨설턴트: [김철수, 이영희]
```

**⚠️ 만약 `[대기중, 김철수, ...]`처럼 표시되면 → 2단계 다시 수행!**

---

### 5단계: 브라우저 테스트 (1분)

**URL**: http://3.34.186.174

**입력 데이터**:
```
회사명: AI테스트병원
기업유형: 병의원개인사업자
담당자: AI테스터
휴대폰: 01099887766
이메일: ai-test@hospital.com
비밀번호: test1234
추천인: 김철수
```

**예상 결과**:
```
✅ "회원가입 신청이 완료되었습니다."
```

**Google Sheets 확인** (기업회원 시트 2행):

| E열(핸드폰번호) | C열(기업유형) | I열(추천인) |
|----------------|--------------|-----------|
| '010-9988-7766 | 병의원개인사업자 | 김철수 |

**✅ 확인사항**:
- E열: `'010-9988-7766` ← 작은따옴표 + 0 유지!
- C열: `병의원개인사업자` ← 비어있지 않음!
- I열: `김철수` ← 비어있지 않음!

---

## 🔍 추가 테스트

### 테스트 1: 추천인 검증 (존재하지 않는 이름)

**입력**: 추천인 = `박영수` (사근복컨설턴트에 없는 이름)

**예상 결과**:
```
❌ "추천인 정보가 올바르지 않습니다.
등록된 컨설턴트: 김철수, 이영희"
```

---

### 테스트 2: 추천인 비어있음

**입력**: 추천인 = (비어있음)

**예상 결과**:
```
❌ "추천인을 반드시 입력해야 합니다."
```

---

### 테스트 3: 중복 전화번호

**입력**: 휴대폰 = `01099887766` (이미 가입된 번호)

**예상 결과**:
```
❌ "이미 가입된 핸드폰 번호입니다."
```

---

## 📋 체크리스트

- [ ] **E열(핸드폰번호)을 "일반 텍스트"로 설정**
- [ ] **사근복컨설턴트 시트에서 "대기중" 완전 삭제**
- [ ] **기업회원 시트 2행 이하 데이터 삭제**
- [ ] **validateSheetStructure() 로그 확인**
- [ ] **브라우저 테스트: 정상 회원가입 성공**
- [ ] **Google Sheets: E열 '010-9988-7766 형식 확인**
- [ ] **Google Sheets: C열/I열 데이터 정상 확인**
- [ ] **추가 테스트 1: 추천인 검증 실패 → 차단**
- [ ] **추가 테스트 2: 추천인 비어있음 → 차단**
- [ ] **추가 테스트 3: 중복 전화번호 → 차단**

---

## 📁 관련 문서

| 문서명 | 경로 | 설명 |
|-------|------|------|
| **V5.3 코드** | `/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.3_FINAL.js` | 최종 코드 (790줄) |
| **상세 체크리스트** | `/home/user/webapp/docs/apps-script-v5/FINAL_DEPLOYMENT_CHECKLIST.md` | 전체 배포 가이드 (7.7KB) |
| **V5.3 요약** | `/home/user/webapp/docs/apps-script-v5/V5.3_SUMMARY.md` | 기술 문서 |

---

## 🔗 링크

- **배포 URL**: https://script.google.com/macros/s/AKfycbzstTD0F-bHhNx3BjHF5rxphKMD0Ejc1IOEJEwFlTfoquSvhL0AXoMk8UXGxjKD__H4/exec
- **프런트엔드**: http://3.34.186.174
- **커밋**: e253416, c91866c

---

## 📞 지원

문제 발생 시:

1. **Apps Script 로그** (Ctrl+Enter)
2. **Google Sheets 스크린샷**
3. **브라우저 콘솔** (F12)

---

**✅ V5.3 코드는 완벽합니다. Google Sheets 설정만 수정하면 완료!**
