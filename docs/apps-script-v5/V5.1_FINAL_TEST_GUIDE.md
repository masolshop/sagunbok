# 🎯 Apps Script V5.1 최종 테스트 가이드

**작성일**: 2026-01-21  
**배포 URL**: https://script.google.com/macros/s/AKfycbxIuaTBEnA6Z7TkAcsvyzHGtT83uGl1WZGuELq5GgyeuoXlGBFASvz8zUsx-5Sc1zBX/exec  
**상태**: ✅ GET 테스트 성공 (V5.1 작동 중)

---

## ✅ GET 테스트 결과 (성공!)

```bash
curl -sL "https://script.google.com/macros/s/AKfycbxIuaTBEnA6Z7TkAcsvyzHGtT83uGl1WZGuELq5GgyeuoXlGBFASvz8zUsx-5Sc1zBX/exec"
```

**응답**:
```json
{
  "success": true,
  "message": "Sagunbok Apps Script V5.1 (EMERGENCY FIX) is running!",
  "timestamp": "2026-01-21T06:09:32.392Z",
  "version": "5.1",
  "fixes": [
    "시트 열 순서 불일치 해결",
    "전화번호 앞자리 0 손실 해결",
    "기업유형과 추천인 누락 해결",
    "추천인 검증 강화"
  ]
}
```

✅ **Apps Script V5.1이 정상 작동 중입니다!**

---

## ⚠️ POST 테스트 (curl 불가)

curl로 POST 요청 시 302 리다이렉트로 인해 "Page Not Found" 오류 발생.  
→ **브라우저에서 프런트엔드를 통해 테스트해야 합니다.**

---

## 🧪 브라우저 테스트 가이드

### 준비사항 (Google Sheets)

#### 1. 사근복컨설턴트 시트에 테스트 데이터 추가

| A열(이름) | B열(핸드폰번호) | C열(이메일) | D열(직함) | E열(소속) | F열(비밀번호) | G열(지사) | H열(가입일시) |
|-----------|-----------------|-------------|-----------|-----------|---------------|-----------|---------------|
| 김철수    | 010-1234-5678   | kim@test.com| 수석      | 의료사업부 | 12345         | 서울지사  | 2026-01-20 10:00:00 |

#### 2. 기업회원 시트 초기화
- 2행 이하 모두 삭제 (헤더는 유지)
- **중요**: A열 전체 선택 → 상단 메뉴 **표시형식** → **일반 텍스트**

#### 3. 헤더 확인
```
A: 핸드폰번호
B: 회사명
C: 기업유형
D: 이름
E: 이메일
F: 비밀번호
G: 추천인
H: 가입일시
I: 승인상태
J: (비어있음)
K: 마지막로그인
```

---

### 테스트 1: 정상 회원가입 (추천인: 김철수)

#### 1-1. 브라우저 접속
```
http://3.34.186.174
```

#### 1-2. 입력 데이터
```
회사명: AI테스트병원
기업유형: 병의원개인사업자
담당자 이름: AI테스터
휴대폰 번호: 01099887766
이메일: ai-test@hospital.com
비밀번호: test1234
추천인: 김철수
```

#### 1-3. 예상 결과
- ✅ 성공 메시지: "회원가입 신청이 완료되었습니다. 관리자 승인 후 로그인 가능합니다."
- ✅ 페이지 리다이렉트: 로그인 페이지 또는 메인 페이지

#### 1-4. Google Sheets 확인
**기업회원 시트의 2행에 다음 데이터가 저장되어야 합니다**:

| 열 | 예상 값 | 확인사항 |
|----|---------|----------|
| A | `010-9988-7766` | ✅ **하이픈 포함** + **앞자리 0 유지** |
| B | `AI테스트병원` | ✅ 회사명 정상 |
| C | `병의원개인사업자` | ✅ **기업유형 저장됨** (이전에 누락됐던 부분!) |
| D | `AI테스터` | ✅ 이름 정상 |
| E | `ai-test@hospital.com` | ✅ 이메일 정상 |
| F | `test1234` | ✅ 비밀번호 정상 |
| G | `김철수` | ✅ **추천인 저장됨** (이전에 누락됐던 부분!) |
| H | `2026-01-21 XX:XX:XX` | ✅ 가입일시 정상 |
| I | `승인전표` | ✅ 승인상태 정상 |
| J | (비어있음) | ✅ 의도적으로 비워둠 |
| K | (비어있음) | ✅ 로그인 후 업데이트됨 |

**중요 확인사항**:
- ❌ **이전 문제**: A열에 타임스탬프가 저장되고, C/G열이 비어있음
- ✅ **V5.1 수정**: 모든 데이터가 올바른 열에 정확히 저장됨

---

### 테스트 2: 추천인 검증 실패

#### 2-1. 입력 데이터
```
회사명: 테스트병원2
기업유형: 개인사업자
담당자 이름: 테스터2
휴대폰 번호: 01099998888
이메일: test2@test.com
비밀번호: test1234
추천인: 존재하지않는이름
```

#### 2-2. 예상 결과
- ❌ 오류 메시지: "추천인 정보가 올바르지 않습니다. 사근복컨설턴트 명단에 등록된 이름을 입력해주세요."
- ❌ 회원가입 차단 (Google Sheets에 데이터 저장 안 됨)

#### 2-3. Google Sheets 확인
- ✅ 기업회원 시트의 데이터 행 수가 변하지 않음 (2행만 존재)

---

### 테스트 3: 중복 전화번호 차단

#### 3-1. 입력 데이터
```
회사명: 테스트병원3
기업유형: 법인
담당자 이름: 테스터3
휴대폰 번호: 01099887766 (이미 가입된 번호)
이메일: test3@test.com
비밀번호: test1234
추천인: 김철수
```

#### 3-2. 예상 결과
- ❌ 오류 메시지: "이미 가입된 핸드폰 번호입니다."
- ❌ 회원가입 차단

#### 3-3. Google Sheets 확인
- ✅ 기업회원 시트의 데이터 행 수가 변하지 않음 (2행만 존재)

---

### 테스트 4: 로그인 (승인 후)

#### 4-1. Google Sheets에서 승인 처리
1. **기업회원** 시트 열기
2. 2행의 I열(승인상태)을 **`승인완료`**로 변경
3. 저장 (Ctrl+S)

#### 4-2. 로그인 시도 (하이픈 없이)
```
전화번호: 01099887766
비밀번호: test1234
```

#### 4-3. 예상 결과
- ✅ 로그인 성공
- ✅ 메인 페이지 또는 대시보드로 이동
- ✅ Google Sheets의 K열(마지막로그인)에 타임스탬프 저장

#### 4-4. Google Sheets 확인
```
K열(마지막로그인): 2026-01-21 XX:XX:XX ← 업데이트됨!
```

---

### 테스트 5: 로그인 (하이픈 포함)

#### 5-1. 로그인 시도 (하이픈 포함)
```
전화번호: 010-9988-7766
비밀번호: test1234
```

#### 5-2. 예상 결과
- ✅ 로그인 성공 (하이픈 유무 무관!)
- ✅ Google Sheets의 K열(마지막로그인) 다시 업데이트

#### 5-3. Google Sheets 확인
```
K열(마지막로그인): 2026-01-21 XX:XX:XX ← 다시 업데이트됨!
```

---

## 📊 V5 vs V5.1 실제 데이터 비교

### ❌ V5 (기존 - 문제 있음)
```
A: 2026-01-21 14:50      ← 타임스탬프가 전화번호 자리에!
B: AI테스트병원
C: AI테스터              ← 이름이 기업유형 자리에!
D: (비어있음)
E: 1099887766            ← 앞자리 0 사라짐!
F: ai-test@hospital.com
G: test1234              ← 비밀번호가 추천인 자리에!
H: (비어있음)
I: 대기중                ← 추천인 검증 실패 (차단되어야 하는데 허용됨)
```

### ✅ V5.1 (수정 - 정상)
```
A: 010-9988-7766         ← 하이픈 포함, 앞자리 0 유지!
B: AI테스트병원
C: 병의원개인사업자      ← 기업유형 정상!
D: AI테스터
E: ai-test@hospital.com
F: test1234
G: 김철수                ← 추천인 정상!
H: 2026-01-21 15:XX:XX
I: 승인전표
J: (비어있음)
K: (로그인 후 업데이트)
```

---

## ✅ 최종 체크리스트

### Google Sheets 준비
- [ ] 사근복컨설턴트 시트에 "김철수" 추가
- [ ] 기업회원 시트의 기존 데이터 삭제
- [ ] A열을 **일반 텍스트** 형식으로 변경
- [ ] 헤더(1행) 확인

### 테스트 실행
- [ ] 테스트 1: 정상 회원가입 (추천인: 김철수) → 성공
- [ ] Google Sheets 확인: A~K열 모두 정상
- [ ] 특히 확인: A열(010-9988-7766), C열(병의원개인사업자), G열(김철수)
- [ ] 테스트 2: 추천인 검증 실패 → 가입 차단
- [ ] 테스트 3: 중복 전화번호 → 가입 차단
- [ ] 테스트 4: 로그인 (하이픈 없이) → 성공 + K열 업데이트
- [ ] 테스트 5: 로그인 (하이픈 포함) → 성공 + K열 재업데이트

---

## 🔍 문제 해결

### 문제: "추천인 정보가 올바르지 않습니다" 메시지
**원인**: 사근복컨설턴트 시트가 비어있거나 이름 불일치  
**해결**:
1. Apps Script 에디터 열기
2. 실행 → `validateSheetStructure` 선택 → 실행
3. 로그 확인: "등록된 이름: 김철수, ..."
4. 정확한 이름으로 재시도

---

### 문제: 전화번호 앞자리 0이 여전히 사라짐
**원인**: A열이 숫자 형식으로 되어있음  
**해결**:
1. Google Sheets에서 A열 전체 선택
2. 상단 메뉴 **표시형식** → **일반 텍스트** 선택
3. 기존 데이터 삭제 후 재가입 테스트

---

### 문제: 브라우저에서 "회원가입 실패" 메시지
**원인**: Apps Script 실행 오류  
**해결**:
1. Apps Script 에디터 → **보기** → **로그**
2. 로그에서 오류 메시지 확인
3. 오류 내용 공유

---

## 📞 테스트 결과 보고

테스트 완료 후 다음 정보를 공유해주세요:

### 성공 시:
- [x] 테스트 1: 정상 회원가입 성공
- [x] Google Sheets 스크린샷 (A~K열 정상 확인)
- [x] 테스트 2~5 모두 통과

### 실패 시:
- [ ] 실패한 테스트 번호
- [ ] 오류 메시지
- [ ] Google Sheets 스크린샷
- [ ] 브라우저 콘솔 오류 (F12 → Console)
- [ ] Apps Script 실행 로그

---

**배포 URL**: https://script.google.com/macros/s/AKfycbxIuaTBEnA6Z7TkAcsvyzHGtT83uGl1WZGuELq5GgyeuoXlGBFASvz8zUsx-5Sc1zBX/exec  
**버전**: V5.1 (긴급 수정판)  
**작성일**: 2026-01-21  
**상태**: ✅ GET 테스트 성공, 브라우저 테스트 대기 중
