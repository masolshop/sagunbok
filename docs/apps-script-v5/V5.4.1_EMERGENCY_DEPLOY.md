# ğŸš€ Apps Script V5.4.1 ê¸´ê¸‰ ë°°í¬ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2026-01-21 18:30  
**ê¸´ê¸‰ ìˆ˜ì •**: JSON body íŒŒì‹± ì§€ì›  
**ì»¤ë°‹**: `91adf77`

---

## ğŸš¨ ë¬¸ì œ ë°œê²¬

**ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸ ê²°ê³¼**:
```javascript
// í”„ë¡ì‹œ ì„œë²„ â†’ Apps Script ìš”ì²­:
{
  "action": "registerCompany",
  "data": {
    "companyName": "í…ŒìŠ¤íŠ¸ë³‘ì›",
    "companyType": "ë³‘ì˜ì›ê°œì¸ì‚¬ì—…ì",
    ...
  }
}

// Apps Script ì‘ë‹µ:
{
  "success": false,
  "error": "ì•Œ ìˆ˜ ì—†ëŠ” actionì…ë‹ˆë‹¤: undefined"
}
```

**ì›ì¸**:
- í”„ë¡ì‹œ ì„œë²„ê°€ **JSON body** ì „ì†¡
- Apps Scriptì˜ `doPost`ê°€ `e.parameter` (form data)ë§Œ íŒŒì‹±
- ê²°ê³¼: `action`ì´ `undefined`, ëª¨ë“  ë°ì´í„° ì†ì‹¤

---

## âœ… í•´ê²°: V5.4.1

### **ë³€ê²½ì‚¬í•­**

```javascript
// âŒ ê¸°ì¡´ (V5.4):
function doPost(e) {
  const params = e.parameter;  // form dataë§Œ íŒŒì‹±
  const action = params.action;
  ...
}

// âœ… ìˆ˜ì • (V5.4.1):
function doPost(e) {
  let params;
  let action;
  
  if (e.postData && e.postData.contents) {
    // JSON ìš”ì²­ ì²˜ë¦¬ (í”„ë¡ì‹œ ì„œë²„)
    const body = JSON.parse(e.postData.contents);
    action = body.action;
    params = body.data || body;
  } else {
    // Form ìš”ì²­ ì²˜ë¦¬ (ë ˆê±°ì‹œ)
    params = e.parameter;
    action = params.action;
  }
  ...
}
```

### **ì§€ì› í˜•ì‹**

1. **JSON í˜•ì‹** (í”„ë¡ì‹œ ì„œë²„ â†’ Apps Script):
   ```json
   {
     "action": "registerCompany",
     "data": {
       "companyName": "í…ŒìŠ¤íŠ¸ë³‘ì›",
       "companyType": "ë³‘ì˜ì›ê°œì¸ì‚¬ì—…ì",
       "name": "í™ê¸¸ë™",
       "phone": "01012345678",
       "email": "test@example.com",
       "password": "test1234",
       "referrer": "ê¹€ì² ìˆ˜"
     }
   }
   ```

2. **Form í˜•ì‹** (ë ˆê±°ì‹œ):
   ```
   action=registerCompany&companyName=í…ŒìŠ¤íŠ¸ë³‘ì›&...
   ```

---

## ğŸ“‹ ë°°í¬ ì ˆì°¨

### **1ï¸âƒ£ Apps Script í¸ì§‘ê¸° ì—´ê¸°**

1. Google Sheets ì—´ê¸°
2. **í™•ì¥ í”„ë¡œê·¸ë¨** â†’ **Apps Script**
3. ê¸°ì¡´ ì½”ë“œ ì „ì²´ ì„ íƒ (Ctrl+A)

---

### **2ï¸âƒ£ V5.4.1 ì½”ë“œ ë¶™ì—¬ë„£ê¸°**

**íŒŒì¼**: `/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.4_FINAL.js`

```bash
# ë¡œì»¬ì—ì„œ í™•ì¸:
cat /home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.4_FINAL.js
```

**ë³µì‚¬ â†’ Apps Script í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸°**

---

### **3ï¸âƒ£ ì €ì¥ ë° ë°°í¬**

1. **íŒŒì¼** â†’ **ì €ì¥** (Ctrl+S)
2. **ë°°í¬** â†’ **ë°°í¬ ê´€ë¦¬**
3. ê¸°ì¡´ ë°°í¬ ì˜† **ì—°í•„ ì•„ì´ì½˜** í´ë¦­
4. **ë²„ì „** â†’ **ìƒˆ ë²„ì „**
5. **ì„¤ëª…**: `V5.4.1 - JSON body íŒŒì‹± ì§€ì›`
6. **ë°°í¬**

**ë°°í¬ URL í™•ì¸** (ë³€ê²½ë˜ì§€ ì•ŠìŒ):
```
https://script.google.com/macros/s/AKfycbxHNpSYLwM87Wn9qq7El3oP3slCD6VOQfIDhimGtlwVCt5I-BV05sIOVKUxjksxEcDv/exec
```

---

### **4ï¸âƒ£ ë°°í¬ í™•ì¸**

```bash
curl -sL "https://script.google.com/macros/s/AKfycbxHNpSYLwM87Wn9qq7El3oP3slCD6VOQfIDhimGtlwVCt5I-BV05sIOVKUxjksxEcDv/exec" | grep version
```

**ì˜ˆìƒ ê²°ê³¼**:
```json
"version": "5.4.1"
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### **Step 1: localhost í…ŒìŠ¤íŠ¸**

```bash
curl -X POST http://localhost:3001/api/auth \
  -H "Content-Type: application/json" \
  -d '{
    "action": "registerCompany",
    "data": {
      "companyName": "V5.4.1í…ŒìŠ¤íŠ¸",
      "companyType": "ë³‘ì˜ì›ê°œì¸ì‚¬ì—…ì",
      "name": "í…ŒìŠ¤í„°",
      "phone": "01044445555",
      "email": "v541@test.com",
      "password": "test1234",
      "referrer": "ê¹€ì² ìˆ˜"
    }
  }'
```

**ì˜ˆìƒ ê²°ê³¼**:
```json
{
  "success": true,
  "message": "íšŒì›ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

---

### **Step 2: ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸**

**URL**: http://3.34.186.174

**ì…ë ¥**:
```
íšŒì‚¬ëª…: V5.4.1ë³‘ì›
ê¸°ì—…ìœ í˜•: ë³‘ì˜ì›ê°œì¸ì‚¬ì—…ì
ë‹´ë‹¹ì: ë²„ì „í…ŒìŠ¤í„°
íœ´ëŒ€í°: 01055556666
ì´ë©”ì¼: browser@test.com
ë¹„ë°€ë²ˆí˜¸: test1234
ì¶”ì²œì¸: ê¹€ì² ìˆ˜
```

**F12 â†’ Console í™•ì¸**:
```javascript
// ì„±ê³µ ë©”ì‹œì§€
âœ… "íšŒì›ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
```

**F12 â†’ Network â†’ /api/auth í´ë¦­**:
```json
Status: 200 OK
Response: {
  "success": true,
  "message": "íšŒì›ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

---

### **Step 3: Google Sheets í™•ì¸**

**[ê¸°ì—…íšŒì›] ì‹œíŠ¸ 2í–‰**:

| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| 2026-01-21... | V5.4.1ë³‘ì› | **ë³‘ì˜ì›ê°œì¸ì‚¬ì—…ì** âœ… | ë²„ì „í…ŒìŠ¤í„° | **'010-5555-6666** âœ… | browser@... | test1234 | **ê¹€ì² ìˆ˜** âœ… | **ìŠ¹ì¸ì „í‘œ** âœ… |

**í™•ì¸ì‚¬í•­**:
- âœ… **Cì—´**: `ë³‘ì˜ì›ê°œì¸ì‚¬ì—…ì` â† ê¸°ì—…ìœ í˜• ì •ìƒ!
- âœ… **Hì—´**: `ê¹€ì² ìˆ˜` â† ì¶”ì²œì¸ ì •ìƒ!
- âœ… **Iì—´**: `ìŠ¹ì¸ì „í‘œ` â† ìŠ¹ì¸ìƒíƒœ ì •ìƒ!
- âœ… **Eì—´**: `'010-5555-6666` â† ì•ìë¦¬ 0 ìœ ì§€!

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì—¬ì „íˆ "ì•Œ ìˆ˜ ì—†ëŠ” action" ì˜¤ë¥˜

**í™•ì¸**:
1. Apps Script í¸ì§‘ê¸°ì—ì„œ **ì‹¤í–‰ ë¡œê·¸** í™•ì¸ (Ctrl+Enter)
2. `doPost ìš”ì²­ (JSON body):` ë¡œê·¸ í™•ì¸

**í•´ê²°**:
- V5.4.1 ì½”ë“œë¥¼ ì •í™•íˆ ë³µì‚¬í–ˆëŠ”ì§€ í™•ì¸
- ì €ì¥ í›„ **ìƒˆ ë°°í¬** ìƒì„± í•„ìˆ˜

---

### ë¬¸ì œ 2: "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" ì˜¤ë¥˜

**í™•ì¸**:
```javascript
// Apps Script ë¡œê·¸:
doPost ìš”ì²­ (JSON body): registerCompany
ë°ì´í„°: {"companyName":"...","companyType":"..."}
```

**ì›ì¸**: 
- `companyType` ë˜ëŠ” `referrer`ê°€ ë¹„ì–´ìˆìŒ

**í•´ê²°**:
- í”„ëŸ°íŠ¸ì—”ë“œì—ì„œ ëª¨ë“  í•„ë“œ ì…ë ¥ í™•ì¸
- ì¶”ì²œì¸: ì‚¬ê·¼ë³µì»¨ì„¤í„´íŠ¸ ì‹œíŠ¸ì˜ ì´ë¦„ê³¼ ì •í™•íˆ ì¼ì¹˜

---

### ë¬¸ì œ 3: ë¸Œë¼ìš°ì € ì½˜ì†”ì— ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜

```javascript
POST http://3.34.186.174/api/auth net::ERR_FAILED
```

**í™•ì¸**:
```bash
# Nginx ìƒíƒœ
sudo systemctl status nginx

# í”„ë¡ì‹œ ì„œë²„ ìƒíƒœ
pm2 list
pm2 logs proxy-server

# Nginx ì˜¤ë¥˜ ë¡œê·¸
sudo tail -f /var/log/nginx/error.log
```

---

## ğŸ“Š V5.4 â†’ V5.4.1 ë³€ê²½ ë¹„êµ

| í•­ëª© | V5.4 | V5.4.1 |
|-----|------|--------|
| **Form data** | âœ… ì§€ì› | âœ… ì§€ì› |
| **JSON body** | âŒ ë¯¸ì§€ì› | âœ… ì§€ì› |
| **í”„ë¡ì‹œ í˜¸í™˜** | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ |
| **doPost íŒŒì‹±** | `e.parameter` | `e.postData.contents` + `e.parameter` |
| **ë°ì´í„° í˜•ì‹** | Flat | `{ action, data }` |

---

## ğŸ“‹ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Apps Script ë°°í¬
- [ ] V5.4.1 ì½”ë“œ ë³µì‚¬
- [ ] Apps Script í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸°
- [ ] ì €ì¥ (Ctrl+S)
- [ ] ë°°í¬ â†’ ìƒˆ ë²„ì „
- [ ] ë°°í¬ URL í™•ì¸

### Google Sheets
- [ ] ì‚¬ê·¼ë³µì»¨ì„¤í„´íŠ¸ ì‹œíŠ¸ì— "ê¹€ì² ìˆ˜" ì¶”ê°€
- [ ] Eì—´ í˜•ì‹: "ì¼ë°˜ í…ìŠ¤íŠ¸"
- [ ] ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ

### ì„œë²„ ì„¤ì •
- [ ] Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì ìš©
- [ ] í”„ë¡ì‹œ ì„œë²„ ì‹¤í–‰ í™•ì¸ (`pm2 list`)

### í…ŒìŠ¤íŠ¸
- [ ] localhost API í…ŒìŠ¤íŠ¸
- [ ] ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ (http://3.34.186.174)
- [ ] F12 ì½˜ì†” ì˜¤ë¥˜ ì—†ìŒ í™•ì¸
- [ ] Google Sheets ë°ì´í„° í™•ì¸ (C, H, I, E ì—´)

---

## ğŸ¯ ê²°ë¡ 

### **V5.4.1 í•µì‹¬ ê°œì„ **

```javascript
// âœ… ì´ì œ í”„ë¡ì‹œ ì„œë²„ì˜ JSON ìš”ì²­ì„ ì •ìƒ ì²˜ë¦¬!

í”„ëŸ°íŠ¸ì—”ë“œ 
  â†“
  POST /api/auth { action, data }
  â†“
Nginx 
  â†“
í”„ë¡ì‹œ ì„œë²„ (localhost:3001)
  â†“
  POST { action, data } (JSON)
  â†“
Apps Script V5.4.1 â† doPostì—ì„œ JSON íŒŒì‹±! âœ…
  â†“
registerCompany({ companyName, companyType, ... })
  â†“
Google Sheets [ê¸°ì—…íšŒì›]
  â†“
Cì—´: ê¸°ì—…ìœ í˜• âœ…
Hì—´: ì¶”ì²œì¸ âœ…
Iì—´: ìŠ¹ì¸ìƒíƒœ âœ…
```

---

## ğŸš€ ì˜ˆìƒ ì†Œìš” ì‹œê°„

1. **Apps Script ë°°í¬**: 2ë¶„
2. **ë°°í¬ í™•ì¸**: 30ì´ˆ
3. **ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸**: 2ë¶„
4. **Google Sheets í™•ì¸**: 1ë¶„

**ì´ ì†Œìš” ì‹œê°„: ì•½ 5ë¶„** â±ï¸

---

**V5.4.1 ê¸´ê¸‰ ë°°í¬ ì™„ë£Œ!** ğŸ‰

**ì»¤ë°‹**: `91adf77`  
**íŒŒì¼**: `/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.4_FINAL.js`
