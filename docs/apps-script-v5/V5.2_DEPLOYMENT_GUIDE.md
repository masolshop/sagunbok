# ✅ Apps Script V5.2 배포 완료 및 최종 테스트 가이드

**배포 URL**: https://script.google.com/macros/s/AKfycbzstTD0F-bHhNx3BjHF5rxphKMD0Ejc1IOEJEwFlTfoquSvhL0AXoMk8UXGxjKD__H4/exec  
**배포일**: 2026-01-21 16:30  
**버전**: V5.2 (FINAL)  
**상태**: ✅ **GET 테스트 성공 - 정상 작동 중!**

---

## ✅ GET 테스트 결과 (성공!)

```json
{
  "success": true,
  "message": "Sagunbok Apps Script V5.2 (FINAL) is running!",
  "timestamp": "2026-01-21T06:32:34.815Z",
  "version": "5.2",
  "sheetStructure": {
    "A": "가입일시",
    "B": "회사명",
    "C": "기업유형",
    "D": "이름",
    "E": "핸드폰번호",
    "F": "이메일",
    "G": "비밀번호",
    "H": "승인상태",
    "I": "추천인",
    "J": "(비어있음)",
    "K": "마지막로그인"
  },
  "fixes": [
    "회원가입 순서에 맞춰 시트 구조 변경",
    "전화번호 E열로 이동, 앞자리 0 손실 해결",
    "기업유형 C열, 추천인 I열 정확히 저장",
    "추천인 검증 절대 강화 (사근복컨설턴트 매칭 필수)"
  ]
}
```

---

## 📊 새로운 시트 구조 (V5.2)

```
A: 가입일시       (yyyy-MM-dd HH:mm:ss)
B: 회사명
C: 기업유형       (개인사업자/법인/병의원개인사업자/의료재단)
D: 이름
E: 핸드폰번호     ('010-1234-5678 형식) ← 중요!
F: 이메일
G: 비밀번호
H: 승인상태       (승인전표/승인완료)
I: 추천인         ← 절대 필수!
J: (비어있음)
K: 마지막로그인
```

---

## 🧪 브라우저 테스트 가이드

### 준비사항 (Google Sheets)

#### ✅ 1. E열(핸드폰번호)을 일반 텍스트로 변경
```
1. Google Sheets 열기
2. E열 클릭 (열 전체 선택)
3. 상단 메뉴: 표시형식 → 일반 텍스트
4. 확인
```

#### ✅ 2. 사근복컨설턴트 시트에 테스트 데이터 추가
```
A열: 김철수
B열: 010-1234-5678
C열: kim@test.com
D열: 수석 컨설턴트
E열: 의료사업부
F열: 12345
G열: 서울지사
H열: 2026-01-20 10:00:00
```

#### ✅ 3. 기업회원 시트 초기화
```
1. 기업회원 시트 열기
2. 2행 이하 모두 선택
3. 우클릭 → 행 삭제
4. 헤더(1행)는 유지
```

---

### 테스트 시나리오

#### 📝 테스트 1: 정상 회원가입 (추천인: 김철수)

**브라우저 접속**:
```
http://3.34.186.174
```

**입력 데이터**:
```
회사명: AI테스트병원
기업유형: 병의원개인사업자
담당자 이름: AI테스터
휴대폰 번호: 01099887766
이메일: ai-test@hospital.com
비밀번호: test1234
추천인: 김철수
```

**예상 결과**:
- ✅ 성공 메시지: "회원가입 신청이 완료되었습니다. 관리자 승인 후 로그인 가능합니다."

**Google Sheets 확인**:
```
A: 2026-01-21 16:XX:XX      ← 가입일시
B: AI테스트병원
C: 병의원개인사업자          ← 기업유형 정상 저장!
D: AI테스터
E: 010-9988-7766            ← 하이픈 포함, 앞자리 0 유지!
F: ai-test@hospital.com
G: test1234
H: 승인전표
I: 김철수                   ← 추천인 정상 저장!
J: (비어있음)
K: (비어있음)
```

**✅ 확인 포인트**:
- [x] C열(기업유형)에 "병의원개인사업자" 저장됨
- [x] E열(핸드폰번호)에 "010-9988-7766" 저장됨 (0 유지!)
- [x] I열(추천인)에 "김철수" 저장됨

---

#### ❌ 테스트 2: 추천인 검증 실패 (존재하지 않는 이름)

**입력 데이터**:
```
회사명: 테스트병원2
기업유형: 개인사업자
담당자 이름: 테스터2
휴대폰 번호: 01099998888
이메일: test2@test.com
비밀번호: test1234
추천인: 존재하지않는이름
```

**예상 결과**:
- ❌ 오류 메시지:
  ```
  추천인 정보가 올바르지 않습니다.
  
  사근복컨설턴트 명단에 등록된 이름을 정확히 입력해주세요.
  
  등록된 컨설턴트: 김철수
  ```
- ❌ 회원가입 차단 (Google Sheets에 데이터 저장 안 됨)

**Google Sheets 확인**:
- ✅ 기업회원 시트의 행 수가 변하지 않음 (2행만 존재)

---

#### ❌ 테스트 3: 추천인 비어있음

**입력 데이터**:
```
회사명: 테스트병원3
기업유형: 법인
담당자 이름: 테스터3
휴대폰 번호: 01099997777
이메일: test3@test.com
비밀번호: test1234
추천인: (입력하지 않음)
```

**예상 결과**:
- ❌ 오류 메시지: "추천인을 반드시 입력해야 합니다."
- ❌ 회원가입 차단

---

#### ❌ 테스트 4: 중복 전화번호

**입력 데이터**:
```
회사명: 테스트병원4
기업유형: 의료재단
담당자 이름: 테스터4
휴대폰 번호: 01099887766 (이미 가입된 번호)
이메일: test4@test.com
비밀번호: test1234
추천인: 김철수
```

**예상 결과**:
- ❌ 오류 메시지: "이미 가입된 핸드폰 번호입니다."
- ❌ 회원가입 차단

---

#### ✅ 테스트 5: 로그인 (승인 후)

**Google Sheets에서 승인 처리**:
```
1. 기업회원 시트 열기
2. 2행의 H열(승인상태)을 "승인완료"로 변경
3. 저장 (Ctrl+S)
```

**로그인 시도 (하이픈 없이)**:
```
전화번호: 01099887766
비밀번호: test1234
```

**예상 결과**:
- ✅ 로그인 성공
- ✅ K열(마지막로그인)에 타임스탬프 저장

**Google Sheets 확인**:
```
K열: 2026-01-21 16:XX:XX ← 업데이트됨!
```

---

#### ✅ 테스트 6: 로그인 (하이픈 포함)

**로그인 시도**:
```
전화번호: 010-9988-7766 (하이픈 포함)
비밀번호: test1234
```

**예상 결과**:
- ✅ 로그인 성공 (하이픈 유무 무관!)
- ✅ K열(마지막로그인) 다시 업데이트

---

## 📊 V5.1 vs V5.2 실제 데이터 비교

### ❌ V5.1 (기존 - 문제)
```
A: 2026-01-21 14:50         ← 타임스탬프가 핸드폰번호 자리에!
B: AI테스트병원
C: AI테스터                 ← 이름이 기업유형 자리에!
D: (비어있음)
E: 1099887766               ← 앞자리 0 사라짐!
F: ai-test@hospital.com
G: test1234
H: (비어있음)
I: 대기중                   ← 추천인이 잘못 저장됨
```

### ✅ V5.2 (수정 - 정상)
```
A: 2026-01-21 16:XX:XX      ← 가입일시 정상!
B: AI테스트병원
C: 병의원개인사업자          ← 기업유형 정상!
D: AI테스터
E: 010-9988-7766            ← 하이픈 포함, 0 유지!
F: ai-test@hospital.com
G: test1234
H: 승인전표
I: 김철수                   ← 추천인 정상!
```

---

## ✅ 최종 체크리스트

### Google Sheets 준비
- [ ] E열을 **일반 텍스트** 형식으로 변경
- [ ] 사근복컨설턴트 시트에 "김철수" 추가
- [ ] 기업회원 시트의 기존 데이터 삭제
- [ ] 헤더(1행) 확인:
  ```
  A: 가입일시, B: 회사명, C: 기업유형, D: 이름, E: 핸드폰번호,
  F: 이메일, G: 비밀번호, H: 승인상태, I: 추천인, J: (비어있음), K: 마지막로그인
  ```

### 브라우저 테스트
- [ ] 테스트 1: 정상 회원가입 (추천인: 김철수) → 성공
- [ ] Google Sheets 확인: A~K열 모두 정상
- [ ] 특히 확인: C열(기업유형), E열(010-9988-7766), I열(김철수)
- [ ] 테스트 2: 추천인 검증 실패 → 가입 차단 + 오류 메시지
- [ ] 테스트 3: 추천인 비어있음 → 가입 차단
- [ ] 테스트 4: 중복 전화번호 → 가입 차단
- [ ] 테스트 5: 로그인 (하이픈 없이) → 성공 + K열 업데이트
- [ ] 테스트 6: 로그인 (하이픈 포함) → 성공 + K열 재업데이트

---

## 🔍 문제 해결

### 문제: "추천인을 반드시 입력해야 합니다" 메시지
**원인**: 추천인 입력 필드가 비어있음  
**해결**: 사근복컨설턴트 시트에 등록된 이름을 입력

---

### 문제: "추천인 정보가 올바르지 않습니다" 메시지
**원인**: 입력한 추천인 이름이 사근복컨설턴트 시트에 없음  
**해결**:
1. Apps Script 에디터 열기
2. **실행** → `validateSheetStructure` 선택 → 실행
3. **보기** → **로그** → "등록된 이름" 확인
4. 정확한 이름으로 재시도 (공백, 오타 주의)

---

### 문제: 전화번호 앞자리 0이 여전히 사라짐
**원인**: E열이 숫자 형식으로 되어있음  
**해결**:
1. Google Sheets에서 E열 전체 선택
2. 상단 메뉴: **표시형식** → **일반 텍스트**
3. 기존 데이터 삭제 후 재가입 테스트

---

### 문제: 기업유형이나 추천인이 저장되지 않음
**원인**: 시트 헤더가 V5.2 구조와 일치하지 않음  
**해결**:
1. 기업회원 시트 1행 확인
2. 헤더 순서가 정확히 일치하는지 확인:
   ```
   A=가입일시, B=회사명, C=기업유형, D=이름, E=핸드폰번호...
   ```
3. 불일치 시 헤더 수정

---

## 📞 테스트 결과 보고

테스트 완료 후 다음 정보를 공유해주세요:

### ✅ 성공 시:
- [x] 테스트 1~6 모두 통과
- [x] Google Sheets 스크린샷 (A~K열 정상 확인)
- [x] 특히 C열(기업유형), E열(010-XXXX-XXXX), I열(추천인) 확인

### ❌ 실패 시:
- [ ] 실패한 테스트 번호
- [ ] 오류 메시지 (정확한 텍스트)
- [ ] Google Sheets 스크린샷
- [ ] 브라우저 콘솔 오류 (F12 → Console)
- [ ] Apps Script 실행 로그 (보기 → 로그)

---

## 📁 관련 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| **V5.2 코드** | `/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.2_FINAL.js` | 790줄, 회원가입 순서 완벽 매칭 |
| **V5.2 요약** | `/home/user/webapp/docs/apps-script-v5/V5.2_SUMMARY.md` | 변경사항 요약 |
| **배포 가이드** | `/home/user/webapp/docs/apps-script-v5/V5.2_DEPLOYMENT_GUIDE.md` | 이 파일 |

---

## 🎯 핵심 포인트 재확인

### 1. 시트 구조 = 회원가입 순서 ✅
모든 데이터가 프런트엔드 폼의 입력 순서대로 저장됨

### 2. 추천인 검증 절대 필수 ✅
- 비어있으면 **무조건 차단**
- 사근복컨설턴트 명단과 **정확히 일치**해야만 가입 가능
- 검증 실패 시 등록된 컨설턴트 목록 표시

### 3. 전화번호 0 손실 해결 ✅
- E열에 `'010-1234-5678` 형식으로 저장
- E열을 반드시 **일반 텍스트** 형식으로 설정

### 4. 기업유형/추천인 정상 저장 ✅
- C열: 기업유형 (개인사업자/법인/병의원개인사업자/의료재단)
- I열: 추천인 (사근복컨설턴트 이름)

---

**배포 URL**: https://script.google.com/macros/s/AKfycbzstTD0F-bHhNx3BjHF5rxphKMD0Ejc1IOEJEwFlTfoquSvhL0AXoMk8UXGxjKD__H4/exec  
**배포일**: 2026-01-21 16:30  
**버전**: V5.2 (FINAL)  
**상태**: ✅ GET 테스트 성공, 브라우저 테스트 준비 완료!

---

**이제 브라우저에서 회원가입 테스트를 진행하고 Google Sheets 데이터를 확인해주세요!** 🚀
