# ✅ Apps Script V5.3 최종 배포 체크리스트

**작성일**: 2026-01-21 17:30  
**버전**: V5.3 FINAL  
**상태**: 🚨 긴급 수정 필요

---

## 🎯 핵심 문제 요약

1. ❌ **시트 열 순서 불일치** - 데이터가 잘못된 위치에 저장됨
2. ❌ **전화번호 앞자리 0 손실** - `1099887766`으로 저장 (010이 사라짐)
3. ❌ **추천인 검증 미작동** - "대기중"이 입력되었는데 가입 허용됨

---

## 📋 STEP 1: Google Sheets 완전 초기화 (⚠️ 필수!)

### 1-1. [기업회원] 시트 초기화

**작업 순서**:

#### ① 2행 이하 데이터 완전 삭제
```
1. 2행부터 마지막 행까지 선택
2. 마우스 우클릭 → "행 삭제"
3. 헤더(1행)만 남기기
```

#### ② E열(핸드폰번호) 일반 텍스트로 변경 ⚠️ 매우 중요!
```
1. E열 전체 선택 (E열 헤더 클릭)
2. 상단 메뉴: 서식 → 숫자 → 일반 텍스트
3. ✅ "일반 텍스트"로 표시되는지 확인
```

> **왜 필요한가?**  
> Google Sheets는 `01099887766`을 숫자로 인식해서 `1099887766`으로 변환합니다.  
> "일반 텍스트"로 설정하면 `'010-1234-5678`처럼 작은따옴표와 함께 저장되어 앞자리 0이 유지됩니다.

#### ③ 헤더 확인 (1행)

| A | B | C | D | E | F | G | H | I | J | K |
|---|---|---|---|---|---|---|---|---|---|---|
| 가입일시 | 회사명 | 기업유형 | 이름 | 핸드폰번호 | 이메일 | 비밀번호 | 승인상태 | 추천인 | (비어있음) | 마지막로그인 |

**⚠️ 헤더가 위와 정확히 일치하는지 확인!**

---

### 1-2. [사근복컨설턴트] 시트 초기화

#### ① "대기중" 행 삭제 ⚠️ 매우 중요!

```
1. A열에서 "대기중"이 있는 행 찾기
2. 해당 행 전체 선택
3. 마우스 우클릭 → "행 삭제"
4. ✅ "대기중"이 완전히 삭제되었는지 확인
```

> **왜 삭제해야 하나?**  
> V5.3 코드는 사근복컨설턴트 시트의 A열(이름)과 추천인을 정확히 매칭합니다.  
> "대기중"이 있으면 사용자가 추천인으로 "대기중"을 입력해도 가입이 허용됩니다!

#### ② 테스트 데이터 추가

**예시**:

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 이름 | 핸드폰번호 | 이메일 | 직함 | 소속 사업단 | 비밀번호 | 소속 지사 | 가입일시 |
| 김철수 | 010-1234-5678 | kim@test.com | 팀장 | 서울사업단 | 12345 | 서울지사 | 2026-01-21 10:00:00 |
| 이영희 | 010-5678-1234 | lee@test.com | 과장 | 부산사업단 | 12345 | 부산지사 | 2026-01-21 11:00:00 |

**⚠️ A열(이름)에 "김철수", "이영희"만 등록되어야 합니다!**

---

### 1-3. 최종 확인

#### ✅ 체크리스트

- [ ] **기업회원 시트 2행 이하 완전 삭제**
- [ ] **E열(핸드폰번호)을 "일반 텍스트"로 설정**
- [ ] **헤더 A~K가 정확히 일치**
- [ ] **사근복컨설턴트 시트에서 "대기중" 완전 삭제**
- [ ] **사근복컨설턴트 시트에 김철수, 이영희 추가**

---

## 📋 STEP 2: Apps Script V5.3 배포

### 2-1. 코드 복사 및 붙여넣기

**경로**: `/home/user/webapp/docs/apps-script-v5/APPS_SCRIPT_V5.3_FINAL.js`

**작업 순서**:

```
1. Google Apps Script 편집기 열기
2. 기존 코드 전체 삭제 (Ctrl+A → Delete)
3. V5.3 코드 전체 복사
4. Apps Script 편집기에 붙여넣기
5. 저장 (Ctrl+S)
```

---

### 2-2. 자동 테스트 실행

#### ① validateSheetStructure() 실행

**목적**: 시트 구조와 데이터 확인

**실행 방법**:
```
1. Apps Script 편집기 상단: 함수 선택 → validateSheetStructure
2. 실행 버튼 (▶️) 클릭
3. 로그 확인 (Ctrl+Enter)
```

**예상 로그**:
```
===== 시트 구조 검증 시작 =====
기업회원 시트: ✅ 존재 (행 수: 1)
사근복컨설턴트 시트: ✅ 존재 (행 수: 3)
등록된 사근복컨설턴트: [김철수, 이영희]
로그인기록 시트: ✅ 존재 (행 수: 1)
✅ 시트 구조 검증 완료
```

**⚠️ 중요 확인사항**:
- `등록된 사근복컨설턴트: [김철수, 이영희]` ← 여기에 "대기중"이 없어야 함!
- 만약 `[대기중, 김철수, 이영희]`처럼 표시되면 → **STEP 1-2로 돌아가서 "대기중" 삭제!**

---

#### ② runAllTests() 실행

**목적**: 전체 기능 테스트

**실행 방법**:
```
1. 함수 선택 → runAllTests
2. 실행 버튼 (▶️) 클릭
3. 로그 확인
```

**예상 로그**:
```
===== 🧪 전체 테스트 시작 =====
🧪 테스트 1: 전화번호 포맷팅
✅ 통과: formatPhone('01012345678') = '010-1234-5678

🧪 테스트 2: 전화번호 정규화
✅ 통과: normalizePhone('010-1234-5678') = 01012345678

🧪 테스트 3: 시트 존재 확인
✅ 통과: 3개 시트 확인

===== 📊 테스트 결과 =====
✅ 통과: 3개
❌ 실패: 0개
✅ 모든 테스트 통과!
```

---

### 2-3. 웹 앱으로 배포

**작업 순서**:

```
1. 상단 메뉴: 배포 → 새 배포
2. 유형 선택: 웹 앱
3. 설명: "V5.3 FINAL - 시트 매핑 수정"
4. 다음 사용자로 실행: 나
5. 액세스 권한: 모든 사용자
6. 배포 버튼 클릭
7. 웹 앱 URL 복사
```

**예시 URL**:
```
https://script.google.com/macros/s/AKfycbzstTD0F-bHhNx3BjHF5rxphKMD0Ejc1IOEJEwFlTfoquSvhL0AXoMk8UXGxjKD__H4/exec
```

---

## 📋 STEP 3: 브라우저 테스트

### 테스트 시나리오 1: 정상 회원가입 (추천인: 김철수)

**URL**: http://3.34.186.174

**입력 데이터**:
```
회사명: AI테스트병원
기업유형: 병의원개인사업자
담당자 이름: AI테스터
휴대폰 번호: 01099887766
이메일: ai-test@hospital.com
비밀번호: test1234
추천인: 김철수
```

**예상 결과**:
```
✅ 성공 메시지: "회원가입 신청이 완료되었습니다. 관리자 승인 후 로그인 가능합니다."
```

**Google Sheets 확인** (기업회원 시트 2행):

| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| 2026-01-21 17:35:20 | AI테스트병원 | 병의원개인사업자 | AI테스터 | '010-9988-7766 | ai-test@hospital.com | test1234 | 승인전표 | 김철수 |

**⚠️ 핵심 확인사항**:
- ✅ **C열(기업유형)**: `병의원개인사업자` ← 비어있지 않음!
- ✅ **E열(핸드폰번호)**: `'010-9988-7766` ← 작은따옴표 + 앞자리 0 유지!
- ✅ **I열(추천인)**: `김철수` ← 비어있지 않음!

---

### 테스트 시나리오 2: 추천인 검증 실패 (존재하지 않는 이름)

**입력 데이터**:
```
회사명: 테스트병원2
기업유형: 개인사업자
담당자 이름: 테스터2
휴대폰 번호: 01099998888
이메일: test2@test.com
비밀번호: test1234
추천인: 박영수  ← 사근복컨설턴트에 없는 이름!
```

**예상 결과**:
```
❌ 오류 메시지:
"추천인 정보가 올바르지 않습니다.

사근복컨설턴트 명단에 등록된 이름을 정확히 입력해주세요.

등록된 컨설턴트: 김철수, 이영희"
```

**Google Sheets 확인**:
```
✅ 기업회원 시트에 데이터가 추가되지 않음 (가입 차단됨!)
```

---

### 테스트 시나리오 3: 추천인 비어있음

**입력 데이터**:
```
회사명: 테스트병원3
기업유형: 법인
담당자 이름: 테스터3
휴대폰 번호: 01088887777
이메일: test3@test.com
비밀번호: test1234
추천인: (비어있음)  ← 아무것도 입력하지 않음!
```

**예상 결과**:
```
❌ 오류 메시지: "추천인을 반드시 입력해야 합니다."
```

**Google Sheets 확인**:
```
✅ 기업회원 시트에 데이터가 추가되지 않음 (가입 차단됨!)
```

---

### 테스트 시나리오 4: 중복 전화번호

**전제조건**: 시나리오 1이 성공하여 `010-9988-7766`이 이미 가입됨

**입력 데이터**:
```
회사명: 테스트병원4
기업유형: 개인사업자
담당자 이름: 테스터4
휴대폰 번호: 01099887766  ← 이미 가입된 번호!
이메일: test4@test.com
비밀번호: test1234
추천인: 김철수
```

**예상 결과**:
```
❌ 오류 메시지: "이미 가입된 핸드폰 번호입니다."
```

**Google Sheets 확인**:
```
✅ 기업회원 시트에 새 데이터가 추가되지 않음 (중복 차단됨!)
```

---

## 🔍 트러블슈팅

### 문제 1: E열에 `1099887766`으로 저장됨 (앞자리 0 손실)

**원인**: E열이 "숫자" 형식으로 설정됨

**해결**:
```
1. STEP 1-1-② 다시 수행
2. E열 전체 선택
3. 서식 → 숫자 → 일반 텍스트
4. 기존 데이터 삭제 후 재가입
```

---

### 문제 2: "대기중"을 추천인으로 입력했는데 가입됨

**원인**: 사근복컨설턴트 시트에 "대기중"이 남아있음

**확인 방법**:
```
1. Apps Script 편집기에서 validateSheetStructure() 실행
2. 로그 확인: "등록된 사근복컨설턴트: [...]"
3. 만약 [대기중, 김철수, ...]처럼 표시되면 → "대기중" 삭제 필요!
```

**해결**:
```
1. STEP 1-2-① 다시 수행
2. 사근복컨설턴트 시트에서 "대기중" 행 완전 삭제
3. validateSheetStructure() 재실행
4. ✅ "등록된 사근복컨설턴트: [김철수, 이영희]"만 표시되는지 확인
```

---

### 문제 3: C열(기업유형), I열(추천인)이 비어있음

**원인**: appendRow 순서가 시트 헤더와 불일치

**확인 방법**:
```
1. Apps Script 편집기에서 registerCompany 함수 찾기 (약 342줄)
2. rowData 배열 확인:
   const rowData = [
     timestamp,            // A: 가입일시
     companyName,          // B: 회사명
     companyType,          // C: 기업유형  ← 여기!
     name,                 // D: 이름
     formattedPhone,       // E: 핸드폰번호
     email,                // F: 이메일
     password,             // G: 비밀번호
     '승인전표',           // H: 승인상태
     referrer              // I: 추천인  ← 여기!
   ];
```

**해결**:
```
1. V5.3 코드는 이미 정확함!
2. 만약 이전 버전(V5.2 이전) 코드를 사용 중이라면 → V5.3으로 교체
3. STEP 2 다시 수행
```

---

## ✅ 최종 체크리스트

### Google Sheets 준비 완료

- [ ] **기업회원 시트 2행 이하 완전 삭제**
- [ ] **E열(핸드폰번호)을 "일반 텍스트"로 설정**
- [ ] **헤더 A~K가 정확히 일치**
- [ ] **사근복컨설턴트 시트에서 "대기중" 완전 삭제**
- [ ] **사근복컨설턴트 시트에 김철수, 이영희 추가**
- [ ] **validateSheetStructure() 실행 → "등록된 사근복컨설턴트: [김철수, 이영희]" 확인**

---

### Apps Script 배포 완료

- [ ] **V5.3 코드 붙여넣기 완료**
- [ ] **validateSheetStructure() 테스트 통과**
- [ ] **runAllTests() 테스트 통과 (3개 통과, 0개 실패)**
- [ ] **웹 앱으로 배포 완료**
- [ ] **새 배포 URL 복사 완료**

---

### 브라우저 테스트 완료

- [ ] **시나리오 1: 정상 회원가입 (김철수) → ✅ 성공**
- [ ] **시나리오 2: 추천인 검증 실패 (박영수) → ❌ 차단**
- [ ] **시나리오 3: 추천인 비어있음 → ❌ 차단**
- [ ] **시나리오 4: 중복 전화번호 → ❌ 차단**

---

### Google Sheets 데이터 확인 완료

- [ ] **C열(기업유형): 병의원개인사업자 ← 비어있지 않음!**
- [ ] **E열(핸드폰번호): '010-9988-7766 ← 작은따옴표 + 앞자리 0 유지!**
- [ ] **I열(추천인): 김철수 ← 비어있지 않음!**

---

## 📁 생성된 파일

| 파일명 | 경로 | 설명 |
|-------|------|------|
| APPS_SCRIPT_V5.3_FINAL.js | /home/user/webapp/docs/apps-script-v5/ | V5.3 최종 코드 (790줄) |
| V5.3_SUMMARY.md | /home/user/webapp/docs/apps-script-v5/ | V5.3 요약 문서 |
| FINAL_DEPLOYMENT_CHECKLIST.md | /home/user/webapp/docs/apps-script-v5/ | 이 문서 (최종 체크리스트) |

---

## 🎯 다음 단계

1. ✅ **이 체크리스트를 하나씩 수행**
2. ✅ **각 단계마다 체크박스 체크**
3. ✅ **문제 발생 시 트러블슈팅 참조**
4. ✅ **모든 테스트 통과 후 최종 배포**

---

## 📞 지원

문제 발생 시 다음 정보를 공유해주세요:

1. **Apps Script 실행 로그** (Ctrl+Enter)
2. **Google Sheets 스크린샷** (기업회원 시트 + 사근복컨설턴트 시트)
3. **브라우저 콘솔 오류** (F12 → Console)
4. **validateSheetStructure() 로그 결과**

---

**배포 URL**: https://script.google.com/macros/s/AKfycbzstTD0F-bHhNx3BjHF5rxphKMD0Ejc1IOEJEwFlTfoquSvhL0AXoMk8UXGxjKD__H4/exec  
**프런트엔드 URL**: http://3.34.186.174  
**커밋**: e253416  
**작성일**: 2026-01-21 17:30

---

**✅ V5.3 코드는 완벽합니다. Google Sheets 설정만 수정하면 모든 문제가 해결됩니다!**
