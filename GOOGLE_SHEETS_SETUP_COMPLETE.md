# 🔗 사근복 AI - Google Sheets 연동 가이드 (최종 확정 버전)

## 📋 최종 시트 구조

### ✅ 기업회원 시트 (10열)
A: 회사명 | B: 기업회원분류 | C: 추천인 | D: 이름 | E: 전화번호 | F: 이메일 | **G: 비밀번호** | H: 가입일 | **I: 승인여부** | **J: 로그기록**

### ✅ 사근복컨설턴트 시트 (10열)
A: 이름 | B: 전화번호 | C: 이메일 | D: 직함 | E: 소속사업단 | F: 소속지사 | **G: 비밀번호** | H: 가입일 | **I: 승인여부** | **J: 로그기록**

---

## 1. Google Sheets 생성

### 1-1. 새 스프레드시트 만들기
1. Google Drive: https://drive.google.com
2. `새로 만들기` → `Google Sheets` → `빈 스프레드시트`
3. 이름: `사근복AI_회원관리_최종`

### 1-2. 스프레드시트 ID 확인
URL에서 복사:
```
https://docs.google.com/spreadsheets/d/[여기가_SPREADSHEET_ID]/edit
```

---

## 2. 시트 구조 설정

### 2-1. 기업회원 시트

**시트 이름**: `기업회원` (정확히 일치해야 함)

**열 구조** (A~J, 총 10열):

| 열 | 필드명 | 타입 | 설명 | 예시 |
|----|--------|------|------|------|
| A | 회사명 | 텍스트 | 회사 이름 | (주)사근복 |
| B | 기업회원분류 | 선택 | 개인사업자/법인/병원 | 법인 |
| C | 추천인 | 텍스트 | 컨설턴트 이름 (검증됨) | 홍길동 |
| D | 이름 | 텍스트 | 대표자/담당자 | 김철수 |
| E | 전화번호 | 텍스트 | ID로 사용 | 010-1234-5678 |
| F | 이메일 | 이메일 | 이메일 주소 | company@example.com |
| G | 비밀번호 | 텍스트 | 로그인 비밀번호 | pass1234 |
| H | 가입일 | 날짜/시간 | 자동 입력 | 2026-01-21 16:30:00 |
| I | 승인여부 | 선택 | 대기중/승인완료/거부 | 승인완료 |
| J | 로그기록 | 텍스트 (긴 텍스트) | 자동 기록 | [2026-01-21 16:30:00] 회원가입 완료 |

**헤더 행 입력** (1행에 정확히 입력):
```
A1: 회사명
B1: 기업회원분류
C1: 추천인
D1: 이름
E1: 전화번호
F1: 이메일
G1: 비밀번호
H1: 가입일
I1: 승인여부
J1: 로그기록
```

### 2-2. 사근복컨설턴트 시트

**시트 이름**: `사근복컨설턴트` (정확히 일치해야 함)

**열 구조** (A~J, 총 10열):

| 열 | 필드명 | 타입 | 설명 | 예시 |
|----|--------|------|------|------|
| A | 이름 | 텍스트 | 컨설턴트 이름 | 홍길동 |
| B | 전화번호 | 텍스트 | ID로 사용 | 010-8765-4321 |
| C | 이메일 | 이메일 | 이메일 주소 | hong@sagunbok.com |
| D | 직함 | 텍스트 | 직함/직책 | 수석 컨설턴트 |
| E | 소속사업단 | 텍스트 | 선택 사항 | 서울사업단 |
| F | 소속지사 | 텍스트 | 선택 사항 | 강남지사 |
| G | 비밀번호 | 텍스트 | 로그인 비밀번호 | 12345 |
| H | 가입일 | 날짜/시간 | 자동 입력 | 2026-01-21 16:30:00 |
| I | 승인여부 | 선택 | 대기중/승인완료/거부 | 승인완료 |
| J | 로그기록 | 텍스트 (긴 텍스트) | 자동 기록 | [2026-01-21 16:30:00] 컨설턴트 가입 완료 |

**헤더 행 입력** (1행에 정확히 입력):
```
A1: 이름
B1: 전화번호
C1: 이메일
D1: 직함
E1: 소속사업단
F1: 소속지사
G1: 비밀번호
H1: 가입일
I1: 승인여부
J1: 로그기록
```

### 2-3. 테스트 데이터 입력

**사근복컨설턴트 시트에 테스트 컨설턴트 추가** (2행):
```
A2: 홍길동
B2: 010-8765-4321
C2: hong@sagunbok.com
D2: 수석 컨설턴트
E2: 서울사업단
F2: 강남지사
G2: 12345
H2: 2026-01-21
I2: 승인완료
J2: [2026-01-21 16:00:00] 테스트 계정 생성
```

---

## 3. Apps Script 배포

### 3-1. Apps Script 편집기 열기
1. Google Sheets에서 `확장 프로그램` → `Apps Script`
2. 새 프로젝트 생성됨

### 3-2. 코드 붙여넣기
1. 기본 `Code.gs` 내용 삭제
2. `/home/user/webapp/google-apps-script/Code-Final.gs` 파일 내용 복사
3. 붙여넣기
4. **중요**: 2번 줄 수정
   ```javascript
   const SPREADSHEET_ID = '여기에_복사한_스프레드시트_ID_붙여넣기';
   ```

### 3-3. 배포
1. 오른쪽 상단 `배포` 버튼 클릭
2. `새 배포` 선택
3. 설정:
   - **유형 선택**: `웹 앱`
   - **설명**: "사근복 AI 백엔드 v2.1"
   - **실행 계정**: `나`
   - **액세스 권한**: `모든 사용자`
4. `배포` 클릭
5. **배포 URL 복사** 
   ```
   https://script.google.com/macros/s/AKfycby.../exec
   ```

### 3-4. 권한 승인
- 첫 배포 시 Google 계정 권한 요청
- `고급` → `[프로젝트 이름] (안전하지 않음)(으)로 이동` 클릭
- `허용` 클릭

---

## 4. React 앱 연동

### 4-1. BACKEND_URL 업데이트
`/home/user/webapp/components/Auth.tsx` 파일 열기:

**10번 줄 수정**:
```typescript
const BACKEND_URL = 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec';
```
→ 위에서 복사한 배포 URL로 교체

### 4-2. 빌드
```bash
cd /home/user/webapp
npm run build
```

### 4-3. 배포
```bash
# EC2 배포 (선택사항)
./deploy-final-to-ec2.sh
```

---

## 5. 기능 설명

### 5-1. 자동 로그 기록
다음 활동이 자동으로 로그기록 열에 추가됩니다:
- ✅ 회원가입 완료
- ✅ 로그인 성공
- ✅ 로그인 실패 - 비밀번호 오류
- ✅ ID 찾기 요청
- ✅ 비밀번호 찾기 요청

**로그 형식 예시**:
```
[2026-01-21 16:30:45] 회원가입 완료
[2026-01-21 16:35:12] 로그인 성공
[2026-01-21 16:40:05] 로그인 실패 - 비밀번호 오류
```

### 5-2. 승인 시스템
**승인여부 값**:
- `대기중`: 가입 직후 (로그인 불가)
- `승인완료`: 관리자 승인 (로그인 가능) ⭐
- `거부`: 가입 거부 (로그인 불가)

**승인 처리 방법**:
1. Google Sheets에서 해당 시트 열기
2. 승인할 행의 I열 찾기
3. 셀 값을 `승인완료`로 변경
4. 완료!

### 5-3. 컨설턴트 비밀번호
- 회원가입 시 자동으로 **12345**로 설정
- Google Sheets G열에 저장
- 관리자가 필요 시 직접 변경 가능

### 5-4. 추천인 검증
- 기업회원 가입 시 추천인 필드 필수
- 사근복컨설턴트 시트에서 이름 검색
- 해당 컨설턴트의 승인여부가 `승인완료`인 경우만 허용

---

## 6. 테스트

### 6-1. 컨설턴트 로그인 테스트
1. 앱 접속
2. `사근복 컨설턴트` 탭
3. 로그인:
   - ID: `010-8765-4321`
   - 비밀번호: `12345`
4. ✅ 성공 → J열 로그 확인

### 6-2. 기업회원 가입 테스트
1. `회원가입` 클릭
2. `기업회원` 탭
3. 입력:
   - 회사명: 테스트 주식회사
   - 기업회원분류: 법인
   - 추천인: 홍길동
   - 이름: 김철수
   - 전화번호: 010-1111-2222
   - 이메일: test@company.com
   - 비밀번호: test1234
   - 비밀번호 확인: test1234
4. ✅ 성공 → J열 로그 확인

### 6-3. 기업회원 로그인 테스트
1. Google Sheets → I열 → `승인완료` 입력
2. 앱에서 로그인:
   - ID: 010-1111-2222
   - 비밀번호: test1234
3. ✅ 성공 → J열 로그 확인

---

## 7. Google Sheets 구조 요약

```
📊 사근복AI_회원관리_최종
│
├── 🏢 기업회원 시트 (10열)
│   ├── A: 회사명
│   ├── B: 기업회원분류 (개인사업자/법인/병원)
│   ├── C: 추천인 ⭐ (컨설턴트 이름 검증)
│   ├── D: 이름
│   ├── E: 전화번호 (ID)
│   ├── F: 이메일
│   ├── G: 비밀번호 ⭐
│   ├── H: 가입일
│   ├── I: 승인여부 ⭐
│   └── J: 로그기록 ⭐
│
└── 👔 사근복컨설턴트 시트 (10열)
    ├── A: 이름 ⭐ (추천인 검증용)
    ├── B: 전화번호 (ID)
    ├── C: 이메일
    ├── D: 직함
    ├── E: 소속사업단
    ├── F: 소속지사
    ├── G: 비밀번호 ⭐ (기본값: 12345)
    ├── H: 가입일
    ├── I: 승인여부 ⭐
    └── J: 로그기록 ⭐
```

---

## 8. 문제 해결

### Q: "등록되지 않은 추천인입니다" 오류
**A**: 
1. 사근복컨설턴트 시트에 해당 이름이 있는지 확인
2. I열(승인여부)이 `승인완료`인지 확인
3. 이름이 정확히 일치하는지 확인 (공백 주의)

### Q: 로그인이 안 됩니다
**A**: 
1. I열(승인여부)이 `승인완료`인지 확인
2. 전화번호 형식 확인 (하이픈 포함)
3. 비밀번호 확인
4. Apps Script 실행 로그 확인

### Q: Apps Script 오류
**A**: 
1. `SPREADSHEET_ID`가 올바른지 확인
2. 시트 이름이 정확한지 확인 (`기업회원`, `사근복컨설턴트`)
3. 열 순서가 맞는지 확인
4. `실행` 메뉴 → `실행 로그` 확인

### Q: 로그가 기록되지 않습니다
**A**: 
1. J열이 존재하는지 확인
2. Apps Script 권한이 승인되었는지 확인
3. 실행 로그에서 오류 확인

---

## 9. 주요 변경사항

### ✅ 컨설턴트 시트에 비밀번호 열 추가
- **이전**: 비밀번호 12345 고정 (코드에만 존재)
- **현재**: G열에 비밀번호 저장 (기본값 12345, 변경 가능)

### ✅ 로그 기록 시스템
- 모든 활동 자동 기록
- 시간 포함 상세 로그
- 여러 줄 지원

### ✅ 승인 시스템
- 가입 후 관리자 승인 필요
- 승인 전 로그인 불가
- 간단한 수동 승인 프로세스

---

## 🎉 완료!

이제 다음 기능을 갖춘 완전한 회원 관리 시스템이 준비되었습니다:

✅ 기업회원: 비밀번호 + 비밀번호 확인  
✅ 컨설턴트: 비밀번호 저장 (기본 12345)  
✅ Google Sheets: 비밀번호, 승인여부, 로그기록  
✅ 자동 로그 시스템  
✅ 추천인 검증 시스템  
✅ 승인 관리 시스템  

**Google Sheets 설정만 완료하면 바로 사용 가능합니다!** 🚀
