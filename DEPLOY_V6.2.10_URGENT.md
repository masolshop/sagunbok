# 🚨 **긴급 수정: Apps Script v6.2.10 배포 가이드**

## 🎯 **발견된 문제**

### 1️⃣ 시트 이름 불일치
- ❌ **getAllMembers**: `'매니저'`, `'컨설턴트'` 사용
- ✅ **실제 시트 이름**: `'사근복컨설턴트(매니저)'`, `'사근복컨설턴트'`
- **결과**: 매니저/컨설턴트 2명씩 있는데 조회 안 됨!

### 2️⃣ 자동 동기화 미작동
- ❌ 기업회원 가입 후 JSON 동기화 안 됨
- ❌ 회원 상태 변경 후 JSON 동기화 안 됨
- **결과**: 수동으로 "💾 수동 동기화" 버튼 클릭 필요

---

## ✅ **v6.2.10 수정 사항**

### 1. 시트 이름 통일
```javascript
// 수정 전 (v6.2.9)
const managerSheet = ss.getSheetByName('매니저');  // ❌
const consultantSheet = ss.getSheetByName('컨설턴트');  // ❌

// 수정 후 (v6.2.10)
const managerSheet = ss.getSheetByName('사근복컨설턴트(매니저)');  // ✅
const consultantSheet = ss.getSheetByName('사근복컨설턴트');  // ✅
```

**적용 위치:**
- ✅ `getAllMembers()` - 회원 목록 조회
- ✅ `updateMemberStatus()` - 상태 변경

### 2. 자동 JSON 동기화 추가
```javascript
// 회원가입/상태변경 성공 후 자동 실행
try {
  syncJsonFiles();
} catch (syncError) {
  Logger.log('JSON 자동 동기화 실패: ' + syncError);
}
```

**적용 위치:**
- ✅ `registerCompany()` - 기업회원 가입 후
- ✅ `registerConsultant()` - 컨설턴트 가입 후
- ✅ `registerManager()` - 매니저 가입 후
- ✅ `updateMemberStatus()` - 상태 변경 후

---

## 🚀 **즉시 배포 방법**

### 1단계: 코드 복사
```bash
cat /home/user/webapp/APPS_SCRIPT_V6.2.10_SHEET_FIX.js
```

### 2단계: Apps Script 에디터
1. https://script.google.com/home
2. 사근복 프로젝트 열기
3. **Ctrl+A** (전체 선택)
4. **Ctrl+V** (새 코드 붙여넣기)
5. **Ctrl+S** (저장)

### 3단계: 배포
1. 우측 상단 **"배포"** → **"배포 관리"**
2. **"수정"** (연필 아이콘)
3. **"버전"** → **"새 버전"**
4. **설명**: `v6.2.10 - 시트 이름 수정 및 자동 동기화 추가`
5. **"배포"** 클릭

### 4단계: 확인
```bash
curl -L 'https://script.google.com/macros/s/AKfycbyULZORS2SzTBYYTK_r_5Kd5Q-I3nELI4RbDim1THqGIX8IT0PiAL-BL2oqomf16ate/exec'
```

**예상 응답:**
```json
{
  "success": true,
  "version": "6.2.10",
  "message": "사근복 AI Apps Script v6.2.10 - 시트 이름 수정 및 자동 동기화 추가"
}
```

---

## ✅ **배포 후 테스트**

### 1. 매니저/컨설턴트 조회 확인
```
관리자 대시보드:
1. "👨‍💼 매니저" 탭 클릭
2. 2명이 표시되는지 확인 ✅

3. "👔 컨설턴트" 탭 클릭
4. 2명이 표시되는지 확인 ✅
```

### 2. 자동 동기화 확인
```
테스트 시나리오:
1. 새 기업회원 가입
2. Google Sheets '로그' 탭 확인
3. "동기화 | JSON | admin | N명 동기화 | 성공" 로그 자동 생성 확인 ✅

또는

1. 회원 상태 변경 (승인 대기 → 승인)
2. Google Sheets '로그' 탭 확인
3. 자동 동기화 로그 생성 확인 ✅
```

### 3. 전체 회원 수 확인
```
관리자 대시보드:
1. "전체" 탭에서 회원 총 수 확인
2. 기업회원 + 매니저 2명 + 컨설턴트 2명 = 모두 표시 ✅
```

---

## 📊 **변경 사항 요약**

| 구분 | v6.2.9 (이전) | v6.2.10 (수정) |
|------|---------------|----------------|
| **getAllMembers 시트 이름** | '매니저', '컨설턴트' ❌ | '사근복컨설턴트(매니저)', '사근복컨설턴트' ✅ |
| **updateMemberStatus 시트 이름** | '매니저', '컨설턴트' ❌ | '사근복컨설턴트(매니저)', '사근복컨설턴트' ✅ |
| **회원가입 후 JSON 동기화** | 없음 ❌ | 자동 실행 ✅ |
| **상태 변경 후 JSON 동기화** | 없음 ❌ | 자동 실행 ✅ |

---

## 🔍 **예상 결과**

### Before (v6.2.9)
```
관리자 대시보드:
- 기업회원: 1명 표시 ✅
- 매니저: 0명 표시 ❌ (실제로는 2명 있음)
- 컨설턴트: 0명 표시 ❌ (실제로는 2명 있음)
- JSON 동기화: 수동 버튼 클릭 필요
```

### After (v6.2.10)
```
관리자 대시보드:
- 기업회원: 1명 표시 ✅
- 매니저: 2명 표시 ✅
- 컨설턴트: 2명 표시 ✅
- JSON 동기화: 자동 실행 ✅
```

---

## 📝 **중요 사항**

1. **프론트엔드 변경 없음**
   - 프론트엔드 코드는 수정 불필요
   - Apps Script만 재배포하면 됨

2. **기존 기능 영향 없음**
   - 로그인 기능 정상 작동
   - 기업회원 조회 정상 작동
   - 기존 API 모두 정상

3. **자동 동기화 오류 처리**
   - 동기화 실패해도 회원가입/상태변경은 성공
   - 오류는 로그에만 기록
   - 사용자에게는 영향 없음

---

## 🎯 **배포 우선순위: 긴급**

이 업데이트는 **현재 작동하지 않는 기능을 수정**하는 것이므로 **즉시 배포**를 권장합니다!

---

**배포 후 관리자 대시보드에서 매니저/컨설턴트 2명씩 표시되는지 확인해 주세요!** 🚀
