# v6.2.12 최종 배포 업데이트 완료

## 📅 배포 일시
**2026-01-24**

## 🔗 새 배포 URL
```
https://script.google.com/macros/s/AKfycbzeunTWd_3je-kVRzz9ZgDe4NLkz1WSG2oeut8h8b4ZUiKrCiCx-cYmPCi5ioOBZmmH/exec
```

## ✅ 완료된 변경사항

### 1. 프론트엔드 API URL 업데이트 ✅
- **파일**: `components/Auth.tsx`
  - 구버전 URL 제거
  - v6.2.12 배포 URL로 업데이트
  - 주석 업데이트: "v6.2.12 FINAL - 시트 이름 수정, 이메일 시스템, 추천인 검증"

- **파일**: `components/AdminView.tsx`
  - 구버전 URL 제거
  - v6.2.12 배포 URL로 업데이트
  - 주석 업데이트: "v6.2.12 FINAL - 시트 이름 수정, 이메일 시스템, 추천인 검증"

### 2. v6.2.12 핵심 기능 (이미 완료)
✅ **시트 이름 수정**
- ❌ `사근복컨설턴트(매니저)` → ✅ `사근복매니저` + `사근복컨설턴트`
- 모든 함수에서 올바른 시트 이름 사용

✅ **이메일 시스템**
- 발신자: TY사근복헬스케어사업단 (tysagunbok@gmail.com)
- 기업회원 가입 시: 회원, 추천인, 관리자에게 이메일 발송
- 매니저/컨설턴트 가입 시: 회원, 관리자에게 이메일 발송
- 승인/반려 시: 해당 회원에게 이메일 발송
- 이메일 라벨: 전체 시트 이름 사용 (`사근복매니저`, `사근복컨설턴트`)

✅ **추천인 검증 시스템**
- 기업회원 가입 시 추천인 이름 검증
- `사근복매니저` 및 `사근복컨설턴트` 시트에서 일치하는 이름 확인
- 유효한 추천인만 등록 허용

✅ **G열 이슈 해결**
- G열 (index 6): 매니저/컨설턴트는 사용하지 않음
- 고정 비밀번호 12345 사용 (CONFIG.DEFAULT_PASSWORD)
- G열 값 '?' 는 로그인에 영향 없음
- 주석으로 명확히 문서화

✅ **대시보드 로그인 버그 수정**
- `Auth.tsx`에 `isSuperAdmin` 필드 추가
- 슈퍼관리자 (01063529091 이종근) 로그인 루프 해결

## 📋 배포 후 테스트 체크리스트

### 🔍 필수 검증 사항

#### 1. API 응답 구조 검증 ✅
```bash
curl "https://script.google.com/macros/s/AKfycbzeunTWd_3je-kVRzz9ZgDe4NLkz1WSG2oeut8h8b4ZUiKrCiCx-cYmPCi5ioOBZmmH/exec?action=getAllMembers&_t=$(date +%s)"
```

**예상 응답 필드 (v6.2.12):**
- ✅ `userType`: 'company' | 'manager' | 'consultant'
- ✅ `approvalStatus`: '승인대기' | '승인' | '승인거부'

**구버전 필드 (제거됨):**
- ❌ `type` 
- ❌ `status`

#### 2. 매니저/컨설턴트 로그인 테스트
- [ ] 매니저 로그인 (전화번호 + 비밀번호 **12345**)
- [ ] 컨설턴트 로그인 (전화번호 + 비밀번호 **12345**)
- [ ] 로그인 성공 후 대시보드 접근 확인

#### 3. 슈퍼관리자 대시보드 테스트
- [ ] 전화번호: **01063529091** (이종근)
- [ ] 대시보드 로그인 루프 없이 정상 접근
- [ ] 모든 회원 목록 표시 확인
- [ ] 매니저/컨설턴트 목록 확인

#### 4. 기업회원 가입 및 이메일 테스트
- [ ] 기업회원 가입 (추천인: 등록된 매니저/컨설턴트 이름)
- [ ] 이메일 발송 확인:
  - [ ] 가입 회원에게 가입 완료 이메일
  - [ ] 추천인(매니저/컨설턴트)에게 알림 이메일
  - [ ] 관리자에게 승인 요청 이메일
- [ ] 이메일 발신자: `TY사근복헬스케어사업단 <tysagunbok@gmail.com>`

#### 5. 추천인 검증 테스트
- [ ] 유효한 추천인 이름으로 가입 (성공 예상)
- [ ] 유효하지 않은 추천인 이름으로 가입 (실패 예상)
- [ ] 오류 메시지: "유효하지 않은 추천인입니다..."

#### 6. 승인/반려 이메일 테스트
- [ ] 관리자 대시보드에서 회원 승인
- [ ] 승인된 회원에게 승인 이메일 발송 확인
- [ ] 회원 반려 테스트
- [ ] 반려된 회원에게 반려 이메일 발송 확인

#### 7. G열 이슈 검증
- [ ] Google Sheets에서 G열 확인
- [ ] G열 값이 '?' 인 매니저/컨설턴트 로그인 테스트
- [ ] 로그인 성공 (G열 값과 무관하게 12345로 인증)

## 🔧 Apps Script 배포 확인 방법

### 배포된 코드 확인
1. Apps Script 에디터 열기:
   ```
   https://script.google.com/home/projects/1BXU0ZcDj81zpKfSBGDnbFpPWFUhZqp_X3zzqLXPpf9C2CxP-kvKY3n5r/edit
   ```

2. 첫 줄 확인:
   ```javascript
   * 버전 6.2.12 - 시트 이름 수정 (올바른 이름으로 변경)
   ```

3. 주요 함수 확인:
   - `getAllMembers()`: `userType`, `approvalStatus` 필드 사용
   - `registerCompany()`: 추천인 검증 로직 포함
   - `sendEmail()`: 전체 시트 이름 라벨 사용

### 배포 버전 확인
1. Deploy → Manage Deployments
2. 활성 배포 URL 확인:
   ```
   https://script.google.com/macros/s/AKfycbzeunTWd_3je-kVRzz9ZgDe4NLkz1WSG2oeut8h8b4ZUiKrCiCx-cYmPCi5ioOBZmmH/exec
   ```
3. Description: "v6.2.12 FINAL" 또는 최신 버전

## 📊 Google Sheets 구조

### 시트 이름 (정확한 이름 필수)
- ✅ `기업회원`
- ✅ `사근복매니저` (구버전 `사근복컨설턴트(매니저)` 아님)
- ✅ `사근복컨설턴트`
- ✅ `로그`

### 열 구조 (공통)
- **A**: 이름
- **B**: 전화번호
- **C**: 이메일
- **D**: 직함 (매니저/컨설턴트) / 빈 값 (기업회원)
- **E**: 소속 사업단 (매니저/컨설턴트) / 기업회원분류 (기업회원)
- **F**: 소속 지사 (매니저/컨설턴트) / 추천인 (기업회원)
- **G**: 비밀번호 (기업회원만 사용, 매니저/컨설턴트는 12345 고정)
- **H**: 가입일 (yyyy-MM-dd HH:mm:ss)
- **I**: 승인여부 ('승인대기', '승인', '승인거부')

### 기업회원 시트 추가 열
- **J**: 회사명

## 🚨 문제 해결

### API가 구버전 응답을 반환하는 경우

**증상:**
- API 응답에 `type`, `status` 필드 사용
- `userType`, `approvalStatus` 필드 없음

**해결 방법:**
1. Apps Script 에디터에서 Code.gs 전체 삭제
2. `/home/user/webapp/APPS_SCRIPT_V6.2.12_CORRECT_SHEET_NAMES.js` 파일 내용 복사
3. Code.gs에 붙여넣기
4. 저장 (Ctrl+S)
5. **Deploy → Manage Deployments → Edit (연필 아이콘)**
6. **New version 선택** (중요!)
7. Version description: "v6.2.12 FINAL REDEPLOY"
8. Deploy 클릭
9. 권한 재승인 (MailApp 권한)
10. 1-2분 대기 후 테스트

## 📁 관련 파일

### Apps Script 백엔드
- `APPS_SCRIPT_V6.2.12_CORRECT_SHEET_NAMES.js` - v6.2.12 최종 코드

### 프론트엔드
- `components/Auth.tsx` - 로그인/회원가입 (API URL 업데이트 완료)
- `components/AdminView.tsx` - 관리자 대시보드 (API URL 업데이트 완료)

### 문서
- `DEPLOY_V6.2.12_URGENT.md` - v6.2.12 배포 가이드
- `V6.2.12_FINAL_CHANGES_SUMMARY.md` - 변경사항 요약
- `V6.2.12_MANUAL_TEST_GUIDE.md` - 수동 테스트 가이드
- `DEPLOYMENT_READY_V6.2.12.md` - 배포 준비 문서
- `V6.2.12_FINAL_DEPLOYMENT_UPDATE.md` - 이 문서

## 🎯 다음 단계

### 1. 프론트엔드 빌드
```bash
cd /home/user/webapp
npm run build
```

### 2. EC2 배포 (선택)
```bash
# 빌드된 파일을 EC2로 복사
scp -r dist/* user@3.34.186.174:/var/www/sagunbok/
```

### 3. 최종 통합 테스트
- 실제 환경에서 모든 체크리스트 항목 확인
- 이메일 발송 확인
- 로그인/가입 플로우 확인

## 📞 지원

문제 발생 시:
1. Apps Script 로그 확인 (View → Logs)
2. 브라우저 개발자 도구 콘솔 확인
3. Google Sheets 데이터 구조 확인
4. 이 문서의 문제 해결 섹션 참조

## ✅ 배포 완료 체크리스트

- [x] v6.2.12 코드 작성 완료
- [x] 프론트엔드 API URL 업데이트
- [x] 배포 문서 작성
- [x] 테스트 스크립트 작성
- [x] Git 커밋 및 PR 생성
- [ ] Apps Script 재배포 확인
- [ ] API 응답 구조 검증
- [ ] 전체 기능 테스트
- [ ] 프론트엔드 빌드
- [ ] EC2 배포 (선택)

---

**배포 상태**: 🟡 프론트엔드 업데이트 완료, Apps Script 재배포 필요  
**PR**: https://github.com/masolshop/sagunbok/pull/1  
**마지막 업데이트**: 2026-01-24
