# 🐛 v2.8 디버그 버전 배포 가이드

## 📋 문제 상황
- ✅ 회원가입 성공
- ❌ 로그인 시 비밀번호 매칭 실패

## 🔍 v2.8 디버그 기능

### **주요 변경사항**

1. **비밀번호 저장 시 명시적 문자열 변환**
   ```javascript
   String(data.password)  // 비밀번호를 문자열로 명시적 변환
   ```

2. **로그인 시 상세 디버그 로그**
   - 입력된 비밀번호 값, 길이, 타입
   - 저장된 비밀번호 값, 길이
   - trim() 후 비교 결과
   - Google Sheets의 J열(로그기록)에 자동 기록

3. **공백 제거 후 비교**
   ```javascript
   const trimmedStored = storedPassword.trim();
   const trimmedInput = inputPassword.trim();
   ```

---

## 🚀 배포 방법

### 1️⃣ **Google Apps Script 편집기 열기**
- 방법 1: https://script.google.com/home → "사근복 AI 백엔드" 프로젝트 클릭
- 방법 2: Google Sheets → 확장 프로그램 → Apps Script

### 2️⃣ **v2.8 코드 복사**
- 파일 위치: `/home/user/webapp/google-apps-script/Code-v2.8-DEBUG.gs`
- 아래 전체 코드를 복사하세요

### 3️⃣ **기존 코드 교체**
1. Apps Script 편집기에서 **전체 선택** (Ctrl+A)
2. **삭제** (Delete)
3. **v2.8 코드 붙여넣기** (Ctrl+V)
4. **저장** (Ctrl+S)

### 4️⃣ **새 배포 생성**
1. **배포** → **새 배포** 클릭
2. **유형**: 웹 앱 선택
3. **설명**: `v2.8 - 비밀번호 디버그 버전`
4. **실행 사용자**: 나(Me)
5. **액세스 권한**: **모든 사용자(Anyone, even anonymous)** ⚠️ 필수!
6. **배포** 클릭

### 5️⃣ **권한 승인** (필요시)
- "이 앱은 Google에서 인증하지 않았습니다" 경고가 나오면:
  1. **고급** 클릭
  2. **안전하지 않은 페이지로 이동** 클릭
  3. **허용** 클릭

### 6️⃣ **배포 URL 확인**
- 배포 완료 후 표시되는 **웹 앱 URL**을 복사
- 형식: `https://script.google.com/macros/s/.../exec`

---

## ✅ 배포 확인

### **브라우저에서 테스트**
배포 URL을 브라우저에 입력하면 다음과 같은 응답이 나와야 합니다:

```json
{
  "status": "ok",
  "message": "사근복 AI 백엔드 API가 정상 작동 중입니다.",
  "version": "2.8-DEBUG",
  "features": [
    "로그기록",
    "승인여부",
    "추천인검증",
    "컨설턴트비밀번호저장",
    "CORS지원",
    "비밀번호디버그"
  ],
  "timestamp": "2026-01-21T..."
}
```

**✅ `"version": "2.8-DEBUG"`가 표시되면 성공!**

---

## 🔍 디버그 정보 확인

### 1️⃣ **로그인 시도**
- 전화번호와 비밀번호를 입력하고 로그인 시도

### 2️⃣ **Google Sheets에서 로그 확인**
1. Google Sheets 열기: https://docs.google.com/spreadsheets/d/1NzBVwAjDTSQWznBapoD1fGspUvXpvQsozdJVSEF5Atc/edit
2. **기업회원** 시트로 이동
3. 해당 사용자의 **J열(로그기록)** 확인

### 3️⃣ **로그 내용 예시**
```
[2026-01-21 23:45:30] 회원가입 완료 (비밀번호 길이: 8)
[2026-01-21 23:46:15] 로그인 시도 - 입력: [test1234] (길이: 8, 타입: string), 저장: [test1234] (길이: 8)
[2026-01-21 23:46:15] 로그인 성공
```

또는 실패 시:
```
[2026-01-21 23:46:15] 로그인 시도 - 입력: [test1234] (길이: 8, 타입: string), 저장: [test123] (길이: 7)
[2026-01-21 23:46:15] 로그인 실패 - 비밀번호 불일치
```

### 4️⃣ **브라우저 콘솔에서 디버그 정보 확인**
- F12 → Console 탭
- 로그인 실패 시 `debug` 객체에 상세 정보 포함:
  ```javascript
  {
    success: false,
    error: "비밀번호가 올바르지 않습니다.",
    debug: {
      inputLength: 8,
      storedLength: 7,
      inputTrimmed: "test1234",
      storedTrimmed: "test123",
      match: false
    }
  }
  ```

---

## 🔧 문제 해결

### **Case 1: 비밀번호 길이가 다른 경우**
- **원인**: 저장 시 비밀번호가 잘렸거나 추가 문자 포함
- **해결**: 
  1. Google Sheets에서 G열(비밀번호) 확인
  2. 올바른 비밀번호로 수동 수정
  3. 다시 로그인 시도

### **Case 2: 비밀번호가 숫자로 저장된 경우**
- **원인**: Google Sheets가 자동으로 숫자로 변환
- **해결**: v2.8에서 `String()` 변환으로 이미 해결됨
- **확인**: 회원가입 시 로그에 "비밀번호 길이: X" 표시

### **Case 3: 승인 상태 문제**
- **원인**: I열(승인여부)이 "승인완료"가 아님
- **해결**:
  1. Google Sheets에서 I열 확인
  2. "대기중" → "승인완료"로 수정
  3. 다시 로그인 시도

---

## 📝 테스트 시나리오

### **1. 새로 회원가입**
```
회사명: 디버그테스트
기업회원분류: 법인
추천인: 이종근
이름: 테스터
전화번호: 01012345678
이메일: debug@test.com
비밀번호: debug1234
비밀번호 확인: debug1234
```

### **2. Google Sheets 확인**
- 기업회원 시트의 J열에서 "비밀번호 길이: 9" 확인

### **3. 승인 처리**
- I열(승인여부)을 "승인완료"로 변경

### **4. 로그인 시도**
```
전화번호: 01012345678
비밀번호: debug1234
```

### **5. 결과 확인**
- ✅ 성공: 메인 페이지로 이동
- ❌ 실패: 
  - Console에서 `debug` 객체 확인
  - Google Sheets J열에서 로그 확인
  - 디버그 정보를 공유해주세요!

---

## 🎯 다음 단계

v2.8 배포 후:

1. **새 배포 URL 공유**
2. **회원가입 테스트** (새 계정)
3. **승인 처리**
4. **로그인 테스트**
5. **디버그 로그 확인** (Google Sheets J열)
6. **문제 발견 시 디버그 정보 공유**

---

**v2.8을 지금 바로 배포하고 로그인을 테스트해 주세요!** 🚀

디버그 정보를 통해 정확한 문제를 파악할 수 있습니다! 😊
