# 🔗 사근복 AI - Google Sheets 연동 가이드 (최종 버전)

## 📋 변경사항
- ✅ 기업회원 가입: 비밀번호 + 비밀번호 확인 (필수)
- ✅ Google Sheets: 비밀번호, 승인여부, 로그기록 열 추가
- ✅ 로그 자동 기록: 회원가입, 로그인, ID/비밀번호 찾기

---

## 1. Google Sheets 생성

### 1-1. 새 스프레드시트 만들기
1. Google Drive 접속: https://drive.google.com
2. `새로 만들기` → `Google Sheets` → `빈 스프레드시트`
3. 스프레드시트 이름: `사근복AI_회원관리_v2`

### 1-2. 스프레드시트 ID 확인
- URL에서 ID 복사: 
  ```
  https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit
  ```

---

## 2. 시트 구조 설정

### 2-1. 기업회원 시트

**시트 이름**: `기업회원`

**열 구조** (A~J):
| 열 | 필드명 | 설명 | 예시 |
|----|--------|------|------|
| A | 회사명 | 회사 이름 | (주)사근복 |
| B | 기업회원분류 | 개인사업자/법인/병원 | 법인 |
| C | 추천인 | 사근복 컨설턴트 이름 | 홍길동 |
| D | 이름 | 대표자/담당자 이름 | 김철수 |
| E | 전화번호 | ID로 사용 | 010-1234-5678 |
| F | 이메일 | 이메일 주소 | company@example.com |
| G | 비밀번호 | 로그인 비밀번호 | pass1234 |
| H | 가입일 | 자동 입력 | 2026-01-21 16:30:00 |
| I | 승인여부 | 대기중/승인완료/거부 | 승인완료 |
| J | 로그기록 | 자동 기록 | [2026-01-21 16:30:00] 회원가입 완료 |

**헤더 행 설정** (1행):
```
A1: 회사명
B1: 기업회원분류
C1: 추천인
D1: 이름
E1: 전화번호
F1: 이메일
G1: 비밀번호
H1: 가입일
I1: 승인여부
J1: 로그기록
```

### 2-2. 사근복컨설턴트 시트

**시트 이름**: `사근복컨설턴트`

**열 구조** (A~I):
| 열 | 필드명 | 설명 | 예시 |
|----|--------|------|------|
| A | 이름 | 컨설턴트 이름 | 홍길동 |
| B | 전화번호 | ID로 사용 | 010-8765-4321 |
| C | 이메일 | 이메일 주소 | hong@sagunbok.com |
| D | 직함 | 직함/직책 | 수석 컨설턴트 |
| E | 소속사업단 | 선택 사항 | 서울사업단 |
| F | 소속지사 | 선택 사항 | 강남지사 |
| G | 가입일 | 자동 입력 | 2026-01-21 16:30:00 |
| H | 승인여부 | 대기중/승인완료/거부 | 승인완료 |
| I | 로그기록 | 자동 기록 | [2026-01-21 16:30:00] 컨설턴트 가입 완료 |

**헤더 행 설정** (1행):
```
A1: 이름
B1: 전화번호
C1: 이메일
D1: 직함
E1: 소속사업단
F1: 소속지사
G1: 가입일
H1: 승인여부
I1: 로그기록
```

### 2-3. 테스트 데이터 입력

#### 사근복컨설턴트 시트에 테스트 컨설턴트 추가:
```
A2: 홍길동
B2: 010-8765-4321
C2: hong@sagunbok.com
D2: 수석 컨설턴트
E2: 서울사업단
F2: 강남지사
G2: 2026-01-21
H2: 승인완료
I2: [2026-01-21 16:00:00] 테스트 계정 생성
```

---

## 3. Apps Script 배포

### 3-1. Apps Script 편집기 열기
1. Google Sheets에서 `확장 프로그램` → `Apps Script`
2. 새 프로젝트 생성

### 3-2. 코드 붙여넣기
1. `Code.gs` 파일에 `google-apps-script/Code-v2.gs` 내용 복사
2. 스프레드시트 ID 설정:
   ```javascript
   const SPREADSHEET_ID = '여기에_스프레드시트_ID_입력';
   ```

### 3-3. 배포
1. 오른쪽 상단 `배포` → `새 배포`
2. 설정:
   - 유형: `웹 앱`
   - 실행 계정: `나`
   - 액세스 권한: `모든 사용자`
3. `배포` 클릭
4. **배포 URL 복사**
   ```
   https://script.google.com/macros/s/AKfycby.../exec
   ```

---

## 4. React 앱 연동

### 4-1. Auth.tsx 수정
`/home/user/webapp/components/Auth.tsx` 파일에서 `BACKEND_URL` 업데이트:

```typescript
const BACKEND_URL = 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec';
```

### 4-2. 빌드 및 배포
```bash
cd /home/user/webapp
npm run build
```

---

## 5. 로그 기록 시스템

### 5-1. 자동 로그 기록 항목
- 회원가입 완료
- 로그인 성공
- 로그인 실패 (비밀번호 오류)
- ID 찾기 요청
- 비밀번호 찾기 요청

### 5-2. 로그 형식
```
[2026-01-21 16:30:45] 회원가입 완료
[2026-01-21 16:35:12] 로그인 성공
[2026-01-21 16:40:05] 로그인 실패 - 비밀번호 오류
[2026-01-21 17:00:00] ID 찾기 요청
[2026-01-21 17:05:30] 비밀번호 찾기 요청
```

### 5-3. 로그 확인 방법
Google Sheets의 J열(기업회원) 또는 I열(컨설턴트)에서 확인 가능

---

## 6. 승인 관리

### 6-1. 승인 상태 값
- `대기중`: 회원가입 직후 기본 상태
- `승인완료`: 관리자가 승인한 상태 (로그인 가능)
- `거부`: 가입 거부 (로그인 불가)

### 6-2. 승인 처리 방법
1. Google Sheets 열기
2. 해당 시트 선택 (기업회원 또는 사근복컨설턴트)
3. 승인할 행의 I열(기업회원) 또는 H열(컨설턴트) 찾기
4. 셀 값을 `승인완료`로 변경
5. 로그 기록에 수동으로 `[날짜 시간] 관리자 승인` 추가 (선택사항)

---

## 7. 테스트

### 7-1. 컨설턴트 로그인
1. 사이트 접속
2. `사근복 컨설턴트` 탭 선택
3. 로그인:
   - ID: `010-8765-4321`
   - 비밀번호: `12345`
4. ✅ 로그인 성공 → 로그기록 확인

### 7-2. 기업회원 가입
1. `회원가입` 클릭
2. `기업회원` 탭
3. 입력:
   - 회사명: `테스트 주식회사`
   - 기업회원분류: `법인`
   - 추천인: `홍길동`
   - 이름: `김철수`
   - 전화번호: `010-1111-2222`
   - 이메일: `test@company.com`
   - 비밀번호: `test1234`
   - 비밀번호 확인: `test1234`
4. ✅ 가입 완료 → 로그기록 확인

### 7-3. 승인 및 로그인
1. Google Sheets에서 I열 → `승인완료` 설정
2. 로그인 시도
3. ✅ 로그인 성공 → 로그기록 확인

---

## 8. 주요 기능

### ✅ 기업회원 가입 필드
1. 회사명 *
2. 기업회원분류 * (드롭다운: 개인사업자/법인/병원)
3. 추천인 * (컨설턴트 이름 검증)
4. 이름 *
5. 전화번호 * (ID)
6. 이메일 *
7. 비밀번호 *
8. 비밀번호 확인 *

### ✅ Google Sheets 추가 기능
- **비밀번호 열**: 평문 저장 (보안 강화 필요 시 해시 처리)
- **승인여부 열**: 관리자가 수동으로 변경
- **로그기록 열**: 모든 활동 자동 기록

### ✅ 검증 기능
- 추천인 검증: 컨설턴트 시트의 승인완료된 이름만 허용
- 전화번호 중복 체크
- 이메일 중복 체크
- 비밀번호 일치 확인 (React 단)
- 비밀번호 최소 길이 확인 (4자리 이상)

---

## 9. Google Sheets 구조 요약

```
📊 사근복AI_회원관리_v2
├── 기업회원 시트 (10열)
│   ├── A: 회사명
│   ├── B: 기업회원분류 (개인사업자/법인/병원)
│   ├── C: 추천인 ⭐
│   ├── D: 이름
│   ├── E: 전화번호 (ID)
│   ├── F: 이메일
│   ├── G: 비밀번호 ⭐
│   ├── H: 가입일
│   ├── I: 승인여부 ⭐
│   └── J: 로그기록 ⭐
│
└── 사근복컨설턴트 시트 (9열)
    ├── A: 이름 ⭐ (추천인 검증용)
    ├── B: 전화번호 (ID)
    ├── C: 이메일
    ├── D: 직함
    ├── E: 소속사업단
    ├── F: 소속지사
    ├── G: 가입일
    ├── H: 승인여부 ⭐
    └── I: 로그기록 ⭐
```

---

## 10. 문제 해결

### Q: 로그가 기록되지 않습니다
**A**: 
1. Apps Script 실행 로그 확인
2. 시트 이름이 정확한지 확인 (`기업회원`, `사근복컨설턴트`)
3. 열 순서가 맞는지 확인

### Q: 비밀번호 확인이 일치하지 않습니다
**A**: 
- React 폼에서 검증하므로 입력 값을 다시 확인

### Q: 추천인이 승인되지 않습니다
**A**: 
1. 컨설턴트 시트에 이름이 정확히 입력되어 있는지 확인
2. H열 승인여부가 `승인완료`인지 확인

---

## 🎉 완료!

이제 다음 기능이 포함된 완전한 회원 관리 시스템이 작동합니다:
- ✅ 비밀번호 + 비밀번호 확인 (필수)
- ✅ Google Sheets에 비밀번호, 승인여부, 로그기록 저장
- ✅ 모든 활동 자동 로그 기록
- ✅ 추천인 검증 시스템
