# 사근복 AI v6.3 업데이트 문서

## 📋 업데이트 일자
2026-01-23

## 🎯 주요 변경사항

### 1. 이메일 발송자명 변경
- **변경 전**: "사근복 AI"
- **변경 후**: "TY사근복헬스케어사업단"

### 2. 전화번호 정규화 기능 추가
- **문제**: Google Sheets에서 전화번호가 "10xxxxxxxx" 형식으로 저장되어 로그인 불가
- **해결**: 전화번호 정규화 함수 추가

#### 추가된 함수
```javascript
function normalizePhoneNumber(phone) {
  if (!phone) return '';
  
  // 문자열로 변환 후 공백 제거
  let normalized = String(phone).trim();
  
  // "10"으로 시작하는 경우 "010"으로 변경
  if (normalized.startsWith('10') && normalized.length === 10) {
    normalized = '0' + normalized;
  }
  
  return normalized;
}
```

#### 적용된 함수들
1. **회원가입**
   - `registerCompany()` - 기업회원 가입
   - `registerManager()` - 사근복매니저 가입
   - `registerConsultant()` - 사근복컨설턴트 가입

2. **로그인**
   - `loginCompany()` - 기업회원 로그인
   - `loginConsultant()` - 매니저/컨설턴트 통합 로그인

### 3. 매니저 + 컨설턴트 통합 로그인
- **기능**: 사근복매니저와 사근복컨설턴트를 하나의 로그인 함수로 처리
- **동작 방식**:
  1. 먼저 매니저 시트에서 검색
  2. 없으면 컨설턴트 시트에서 검색
  3. userType으로 'manager' 또는 'consultant' 구분

### 4. 추천인 검증 (기존 구현 확인)
- **함수**: `getConsultantEmailByName()`
- **동작**: 매니저 시트 → 컨설턴트 시트 순으로 검색
- **목적**: 기업회원 가입 시 추천인 이메일 발송

---

## 📊 시스템 구조

### Google Sheets 구조
1. **기업회원** 시트
   - 회사명, 회사구분, 추천인, 이름, 전화번호, 이메일, 비밀번호, 가입일, 승인여부

2. **사근복매니저** 시트 (신규)
   - 이름, 전화번호, 이메일, 직위, 소속사업단, 소속지사, 비밀번호, 가입일, 승인여부

3. **사근복컨설턴트** 시트
   - 이름, 전화번호, 이메일, 직위, 소속사업단, 소속지사, 비밀번호, 가입일, 승인여부

4. **로그기록** 시트
   - 타임스탬프, 액션유형, 사용자유형, 사용자ID, 상세내용, 상태, 오류메시지

### JSON 백업
- `sagunbok_members_all.json`: 전체 회원 (기업 + 매니저 + 컨설턴트)
- `sagunbok_members_by_consultant.json`: 추천인별 기업회원 목록

---

## ✅ 테스트 체크리스트

### 1. 이메일 발송자명 확인
- [ ] 기업회원 가입 이메일 발송자: "TY사근복헬스케어사업단"
- [ ] 매니저 가입 이메일 발송자: "TY사근복헬스케어사업단"
- [ ] 컨설턴트 가입 이메일 발송자: "TY사근복헬스케어사업단"
- [ ] 승인 이메일 발송자: "TY사근복헬스케어사업단"

### 2. 전화번호 정규화 테스트
- [ ] "10xxxxxxxx" 입력 → "010xxxxxxxx"로 저장
- [ ] "010xxxxxxxx" 입력 → "010xxxxxxxx"로 저장 (그대로)
- [ ] Google Sheets에서 전화번호 "010" 형식으로 표시 확인

### 3. 로그인 테스트
- [ ] 기업회원: "10xxxxxxxx" 입력으로 로그인 성공
- [ ] 기업회원: "010xxxxxxxx" 입력으로 로그인 성공
- [ ] 매니저: "10xxxxxxxx" 입력으로 로그인 성공
- [ ] 매니저: "010xxxxxxxx" 입력으로 로그인 성공
- [ ] 컨설턴트: "10xxxxxxxx" 입력으로 로그인 성공
- [ ] 컨설턴트: "010xxxxxxxx" 입력으로 로그인 성공

### 4. 회원가입 테스트
- [ ] 매니저 회원가입 성공
- [ ] 컨설턴트 회원가입 성공
- [ ] 기업회원 가입 시 매니저 추천인 이메일 발송
- [ ] 기업회원 가입 시 컨설턴트 추천인 이메일 발송

---

## 🚀 배포 방법

### 1. Apps Script 배포
1. Google Sheets 열기: https://docs.google.com/spreadsheets/d/1NzBVwAjDTSQWznBapoD1fGspUvXpvQsozdJVSEF5Atc/edit
2. Extensions > Apps Script
3. `COMPLETE_V6.2_CODE.js` 전체 코드 복사
4. Apps Script 편집기에 붙여넣기
5. 새 배포 생성:
   - 배포 이름: "v6.3 전화번호 정규화 및 이메일 발송자 변경"
   - 유형: 웹앱
   - 실행: 나
   - 접근: 누구나
6. Gmail 권한 승인

### 2. 배포 URL 업데이트
- 새 배포 URL을 프론트엔드 Auth.tsx, AdminView.tsx에 업데이트

---

## 📝 버전 히스토리

### v6.3 (2026-01-23)
- 이메일 발송자명: "TY사근복헬스케어사업단"
- 전화번호 정규화 기능 추가
- 매니저 + 컨설턴트 통합 로그인

### v6.2 (2026-01-23)
- 이메일 알림 시스템 추가
- 회원가입/승인 시 자동 이메일 발송

### v6.1 (2026-01-22)
- POST + GET 요청 통합 지원
- JSON DB 이중 백업
- 사근복매니저 시트 추가

---

## 🔧 다음 작업 (Phase 2-4)

### Phase 2: 프론트엔드 수정
1. Auth.tsx: 로그인/회원가입에 '사근복매니저' 추가
2. AdminView.tsx: 매니저 필터 추가

### Phase 3: 테스트
1. 매니저 회원가입 테스트
2. 컨설턴트 회원가입 테스트
3. 기업회원 가입 시 추천인 검증 테스트 (매니저 + 컨설턴트)
4. 통합 로그인 테스트

### Phase 4: 배포
1. Apps Script 배포
2. 프론트엔드 빌드 및 배포
3. 이메일 알림 테스트

---

## 📞 문의사항
추가 문의사항이 있으시면 말씀해주세요!
